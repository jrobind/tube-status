!function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=19)}([function(t,e,n){t.exports=n(12)},function(t,e){function n(t,e,n,i,r,a,s){try{var o=t[a](s),c=o.value}catch(t){return void n(t)}o.done?e(c):Promise.resolve(c).then(i,r)}t.exports=function(t){return function(){var e=this,i=arguments;return new Promise((function(r,a){var s=t.apply(e,i);function o(t){n(s,r,a,o,c,"next",t)}function c(t){n(s,r,a,o,c,"throw",t)}o(void 0)}))}}},function(t,e){function n(e){return t.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},n(e)}t.exports=n},function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},function(t,e){function n(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}t.exports=function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}},function(t,e,n){var i=n(10),r=n(13);t.exports=function(t,e){return!e||"object"!==i(e)&&"function"!=typeof e?r(t):e}},function(t,e,n){var i=n(9);t.exports=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&i(t,e)}},function(t,e,n){var i=n(2),r=n(9),a=n(14),s=n(15);function o(e){var n="function"==typeof Map?new Map:void 0;return t.exports=o=function(t){if(null===t||!a(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(t))return n.get(t);n.set(t,e)}function e(){return s(t,arguments,i(this).constructor)}return e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),r(e,t)},o(e)}t.exports=o},function(t,e,n){var i=n(16),r=n(17),a=n(18);t.exports=function(t){return i(t)||r(t)||a()}},function(t,e){function n(e,i){return t.exports=n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},n(e,i)}t.exports=n},function(t,e){function n(e){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?t.exports=n=function(t){return typeof t}:t.exports=n=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(e)}t.exports=n},function(t,e){t.exports=function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}},function(t,e,n){var i=function(t){"use strict";var e=Object.prototype,n=e.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},r=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function o(t,e,n,i){var r=e&&e.prototype instanceof l?e:l,a=Object.create(r.prototype),s=new k(i||[]);return a._invoke=function(t,e,n){var i="suspendedStart";return function(r,a){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===r)throw a;return w()}for(n.method=r,n.arg=a;;){var s=n.delegate;if(s){var o=m(s,n);if(o){if(o===u)continue;return o}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===i)throw i="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i="executing";var l=c(t,e,n);if("normal"===l.type){if(i=n.done?"completed":"suspendedYield",l.arg===u)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i="completed",n.method="throw",n.arg=l.arg)}}}(t,n,s),a}function c(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=o;var u={};function l(){}function d(){}function h(){}var p={};p[r]=function(){return this};var f=Object.getPrototypeOf,v=f&&f(f(S([])));v&&v!==e&&n.call(v,r)&&(p=v);var b=h.prototype=l.prototype=Object.create(p);function y(t){["next","throw","return"].forEach((function(e){t[e]=function(t){return this._invoke(e,t)}}))}function _(t,e){var i;this._invoke=function(r,a){function s(){return new e((function(i,s){!function i(r,a,s,o){var u=c(t[r],t,a);if("throw"!==u.type){var l=u.arg,d=l.value;return d&&"object"==typeof d&&n.call(d,"__await")?e.resolve(d.__await).then((function(t){i("next",t,s,o)}),(function(t){i("throw",t,s,o)})):e.resolve(d).then((function(t){l.value=t,s(l)}),(function(t){return i("throw",t,s,o)}))}o(u.arg)}(r,a,i,s)}))}return i=i?i.then(s,s):s()}}function m(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,m(t,e),"throw"===e.method))return u;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var i=c(n,t.iterator,e.arg);if("throw"===i.type)return e.method="throw",e.arg=i.arg,e.delegate=null,u;var r=i.arg;return r?r.done?(e[t.resultName]=r.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,u):r:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,u)}function g(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(g,this),this.reset(!0)}function S(t){if(t){var e=t[r];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,a=function e(){for(;++i<t.length;)if(n.call(t,i))return e.value=t[i],e.done=!1,e;return e.value=void 0,e.done=!0,e};return a.next=a}}return{next:w}}function w(){return{value:void 0,done:!0}}return d.prototype=b.constructor=h,h.constructor=d,h[s]=d.displayName="GeneratorFunction",t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,h):(t.__proto__=h,s in t||(t[s]="GeneratorFunction")),t.prototype=Object.create(b),t},t.awrap=function(t){return{__await:t}},y(_.prototype),_.prototype[a]=function(){return this},t.AsyncIterator=_,t.async=function(e,n,i,r,a){void 0===a&&(a=Promise);var s=new _(o(e,n,i,r),a);return t.isGeneratorFunction(n)?s:s.next().then((function(t){return t.done?t.value:s.next()}))},y(b),b[s]="Generator",b[r]=function(){return this},b.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var i=e.pop();if(i in t)return n.value=i,n.done=!1,n}return n.done=!0,n}},t.values=S,k.prototype={constructor:k,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function i(n,i){return s.type="throw",s.arg=t,e.next=n,i&&(e.method="next",e.arg=void 0),!!i}for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var o=n.call(a,"catchLoc"),c=n.call(a,"finallyLoc");if(o&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(o){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(t,e){for(var i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i];if(r.tryLoc<=this.prev&&n.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var s=a?a.completion:{};return s.type=t,s.arg=e,a?(this.method="next",this.next=a.finallyLoc,u):this.complete(s)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),u},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),E(n),u}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var i=n.completion;if("throw"===i.type){var r=i.arg;E(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:S(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},t}(t.exports);try{regeneratorRuntime=i}catch(t){Function("r","regeneratorRuntime = r")(i)}},function(t,e){t.exports=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}},function(t,e){t.exports=function(t){return-1!==Function.toString.call(t).indexOf("[native code]")}},function(t,e,n){var i=n(9);function r(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function a(e,n,s){return r()?t.exports=a=Reflect.construct:t.exports=a=function(t,e,n){var r=[null];r.push.apply(r,e);var a=new(Function.bind.apply(t,r));return n&&i(a,n.prototype),a},a.apply(null,arguments)}t.exports=a},function(t,e){t.exports=function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}},function(t,e){t.exports=function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}},function(t,e,n){"use strict";n.r(e);var i=n(0),r=n.n(i),a=n(1),s=n.n(a),o=n(3),c=n.n(o),u=n(4),l=n.n(u),d=n(5),h=n.n(d),p=n(2),f=n.n(p),v=n(6),b=n.n(v),y=n(7),_=n.n(y),m=n(8),g=n.n(m),E=n(11),k=n.n(E);function S(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function w(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?S(Object(n),!0).forEach((function(e){k()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):S(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var L=function(t,e){var n=[],i=e;return{getStore:function(){return i},updateStore:function(e){var r=n.length;i=t(i,e),r&&n.forEach((function(t){var n=t.callback;t.action===e.action&&n()}))},subscribeToStore:function(t){Array.isArray(t)?t.forEach((function(t){return n.push(t)})):n.push(t)}}}((function(t,e){var n=e.action,i=e.data;switch(n){case"LINES":return t=w({},t,{lineInformation:w({},i.lineInformation),lineData:{lines:w({},i.result)}});case"AUTH":return t=w({},t,{userProfile:w({},i)});case"LOADING-APP":case"LOADING-LINE":case"LOADING-HEADER":case"PUSH-SUBSCRIPTION":return t=w({},t,{},i);case"LINE-SUBSCRIBE":case"LINE-UNSUBSCRIBE":return t=w({},t,{lineSubscriptions:g()(i.lineSubscriptions)});case"SELECTED-DAYS":case"SELECTED-HOURS":case"RESET-SELECTED":return t=w({},t,{selectedSubscriptionWindow:w({},i)});case"RESET-APP":return t=w({},t,{lineSubscriptions:[]});case"NOTIFICATIONS-FEATURE":return t=w({},t,{},i)}}),{lineData:{lines:{}},userProfile:{signedIn:!1,id:null,avatar:null},loadingState:{state:!1,line:null},pushSubscription:null,selectedSubscriptionWindow:{days:null,hours:null},lineSubscriptions:[],lineInformation:null,notificationsFeature:null}),x=function(){var t=s()(r.a.mark((function t(){var e,n;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e={method:"POST",headers:{"content-type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("JWT"))}},t.next=3,fetch("api/logout",e).catch((function(t){return console.error(t)}));case 3:return n=t.sent,t.abrupt("return",n.status);case 5:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),C=function(){var t=s()(r.a.mark((function t(){var e,n;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e={method:"GET",headers:{"content-type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("JWT"))}},t.next=3,fetch("api/download",e).catch((function(t){return console.error(t)}));case 3:return n=t.sent,t.abrupt("return",n);case 5:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),I=function(){var t=s()(r.a.mark((function t(){var e,n;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e={method:"DELETE",headers:{"content-type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("JWT"))}},t.next=3,fetch("api/remove",e).catch((function(t){return console.error(t)}));case 3:return n=t.sent,t.abrupt("return",n.status);case 5:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),T=function(){var t=s()(r.a.mark((function t(e,n,i){var a,s;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a={method:"POST",body:JSON.stringify({pushSubscription:e,line:n,window:i}),headers:{"content-type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("JWT"))}},t.next=3,fetch("api/subscribe",a).catch((function(t){return console.error(t)}));case 3:return s=t.sent,console.log(s),t.next=7,s.json();case 7:return t.abrupt("return",t.sent);case 8:case"end":return t.stop()}}),t)})));return function(e,n,i){return t.apply(this,arguments)}}(),A=function(){var t=s()(r.a.mark((function t(e){var n,i;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={method:"DELETE",body:JSON.stringify({line:e}),headers:{"content-type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("JWT"))}},t.next=3,fetch("api/subscribe",n).catch((function(t){return console.error(t)}));case 3:return i=t.sent,console.log(i),t.next=7,i.json();case 7:return t.abrupt("return",t.sent);case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),P=function(){var t=s()(r.a.mark((function t(){var e;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("api/lines").catch((function(t){return console.error(t)}));case 2:return e=t.sent,t.next=5,e.json();case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),O=function(){var t=s()(r.a.mark((function t(){var e,n;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e={method:"GET",headers:{"content-type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("JWT"))}},t.next=3,fetch("api/subscribe",e).catch((function(t){return console.error(t)}));case 3:return n=t.sent,t.next=6,n.json();case 6:return t.abrupt("return",t.sent);case 7:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),N=L.updateStore,q="BKpELtYde7iajTdW7hw1LOIksmgzApC5IMLUtwDkqDA_fdqWmdQ3FqU2azo0LH0G-2cIqq11gRrxCLtFj-pPSmE",D=function(){var t=s()(r.a.mark((function t(){return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!("serviceWorker"in navigator)){t.next=4;break}return t.next=3,j().catch(W);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();function j(){return M.apply(this,arguments)}function M(){return(M=s()(r.a.mark((function t(){return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,navigator.serviceWorker.register("/sw.js").catch(W);case 2:return t.next=4,navigator.serviceWorker.ready.then(function(){var t=s()(r.a.mark((function t(e){var n;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.active){t.next=11;break}if(!e.pushManager){t.next=9;break}return t.next=4,e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:R(q)}).catch(W);case 4:return n=t.sent,N({action:"PUSH-SUBSCRIPTION",data:{pushSubscription:n}}),t.abrupt("return",n);case 9:return N({action:"PUSH-SUBSCRIPTION",data:{pushSubscription:null}}),t.abrupt("return",null);case 11:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function R(t){for(var e=(t+"=".repeat((4-t.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=window.atob(e),i=new Uint8Array(n.length),r=0;r<n.length;++r)i[r]=n.charCodeAt(r);return i}function W(t){console.error(t)}var H=n(10),K=n.n(H),U=L.getStore,F="tube-status-focus",B="button:not([disabled]), [tabindex]",G=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=document.createElement(t),i=e.copy,r=e.id,a=e.data,s=void 0===a?{}:a,o=e.classname;if(!Object.keys(e).length)return n;if(i&&(n.innerText=i),r&&n.setAttribute("id",r),Array.isArray(o)?o.forEach((function(t){return n.classList.add(t)})):o&&n.classList.add(o),Array.isArray(s)?s.forEach((function(t){var e=t.name,i=t.value;return n.setAttribute(e,i)})):Object.keys(s).length&&n.setAttribute(s.name,s.value),Array.isArray(e.event))e.event.forEach((function(t){return n.addEventListener(t.type,t.fn)}));else if("object"===K()(e.event)){var c=e.event,u=c.type,l=c.fn;n.addEventListener(u,l)}return n},J=function(t){return"day"===t?["Mo","Tu","We","Th","Fr","Sa","Su"]:["5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24"]},Y=function(t){return t.map((function(t){return delete t._id,t}))},z=function(t){return t.reduce((function(t,e){return!!t.filter((function(t){return t.reason===e.reason})).length||t.push(e),t}),[])},V=function(t){document.querySelectorAll(".".concat(F)).forEach((function(t){return t.classList.remove(F)})),t instanceof HTMLElement?t.classList.add(F):t.target.classList.add(F)},Q=function(t){var e=t.querySelectorAll(B),n=e[0],i=e[e.length-1];t.addEventListener("keydown",(function(t){9===t.which&&(t.shiftKey?document.activeElement===n&&(i.focus(),t.preventDefault()):document.activeElement===i&&(n.focus(),t.preventDefault()))}))},X="LINES",Z="AUTH",$="LOADING-APP",tt="LOADING-LINE",et="LOADING-HEADER",nt="LINE-SUBSCRIBE",it="LINE-UNSUBSCRIBE",rt="SELECTED-DAYS",at="SELECTED-HOURS",st="RESET-SELECTED",ot="RESET-APP",ct="NOTIFICATIONS-FEATURE",ut="line-click",lt="modal-close",dt="show-subscribe",ht="show-week",pt="show-time",ft="filter-subscriptions",vt="app-ready",bt="privacy-policy",yt="No Service",_t="Service Closed",mt="Part Closure",gt="Planned Closure",Et="Part Suspended",kt="Severe Delays",St="Minor Delays",wt="Good Service",Lt="Special Service",xt="Subscribe for line notifications",Ct="This browser does not support Push notifications",It="Unsubscribe from line notifications",Tt="Unable to subscribe to line at this time.",At="Account successfully deleted.",Pt="Line successfully subscribed!",Ot="Line successfully unsubscribed.",Nt=L.updateStore,qt=L.getStore,Dt=".tube-line",jt=".tube-line-sub__image-wrapper",Mt=".tube-status-wrapper__message",Rt=".tube-status-footer",Wt=".tube-status-header",Ht=".tube-status-header__subscription",Kt=".tube-status-note",Ut="tube-status-wrapper__message",Ft="tube-status-filter",Bt="tube-status-hide",Gt=function(t){function e(){return c()(this,e),h()(this,f()(e).call(this))}var n,i,a,o,u;return b()(e,t),l()(e,[{key:"connectedCallback",value:(u=s()(r.a.mark((function t(){var e;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Nt({action:$,data:{loadingState:{state:!0,line:null}}}),t.next=3,D();case 3:return e=t.sent,t.next=6,this.updateNotifcationFeatureFlag_(e);case 6:return t.next=8,this.getAllLineData_();case 8:return t.next=10,this.getLineSubscriptions_();case 10:this.order_(),this.appReady_(),Nt({action:$,data:{loadingState:{state:!1,line:null}}}),document.addEventListener(ft,this.filterView_.bind(this)),"safari"in window!=1&&new BroadcastChannel("sw-messages").addEventListener("message",this.handleNotificationRecieved_.bind(this)),this.fetchInterval_();case 16:case"end":return t.stop()}}),t,this)}))),function(){return u.apply(this,arguments)})},{key:"updateNotifcationFeatureFlag_",value:(o=s()(r.a.mark((function t(e){return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:Nt({action:ct,data:{notificationsFeature:!!e}});case 2:case"end":return t.stop()}}),t)}))),function(t){return o.apply(this,arguments)})},{key:"order_",value:function(){var t=this,e=Array.from(document.querySelectorAll(Dt)).sort((function(t,e){return+e.getAttribute("score")-+t.getAttribute("score")}));Array.from(this.children).forEach((function(e){e.classList.contains(Ft)||t.removeChild(e)})),e.forEach((function(e){return t.appendChild(e)}))}},{key:"getLineSubscriptions_",value:(a=s()(r.a.mark((function t(){var e;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!qt().userProfile.signedIn){t.next=6;break}return t.next=4,O();case 4:(e=t.sent).subscriptions?Nt({action:nt,data:{lineSubscriptions:Y(e.subscriptions)}}):this.handleError_(e);case 6:case"end":return t.stop()}}),t,this)}))),function(){return a.apply(this,arguments)})},{key:"getAllLineData_",value:(i=s()(r.a.mark((function t(){var e,n;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,P();case 2:if(!(e=t.sent)){t.next=8;break}return Array.isArray(e)?n=this.formatLineInformation_(e):this.handleError_(e),t.abrupt("return",Nt({action:X,data:{result:e,lineInformation:n}}));case 8:this.handleError_(e);case 9:case"end":return t.stop()}}),t,this)}))),function(){return i.apply(this,arguments)})},{key:"formatLineInformation_",value:function(t){return t.reduce((function(t,e){return e.lineStatuses.forEach((function(n){var i=n.statusSeverityDescription,r=n.reason,a=e.id,s={status:i,reason:r||null};t[a]?t[a].push(s):t[a]=[s]})),t}),{})}},{key:"fetchInterval_",value:function(){var t=this;setInterval(s()(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Nt({action:$,data:{loadingState:{state:!0,line:null}}}),e.next=3,t.getAllLineData_();case 3:Nt({action:$,data:{loadingState:{state:!1,line:null}}});case 4:case"end":return e.stop()}}),e)}))),6e4)}},{key:"handleNotificationRecieved_",value:(n=s()(r.a.mark((function t(e){return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("push received"!==e.data.title){t.next=6;break}return Nt({action:$,data:{loadingState:{state:!0,line:null}}}),t.next=5,this.getAllLineData_();case 5:Nt({action:$,data:{loadingState:{state:!1,line:null}}});case 6:case"end":return t.stop()}}),t,this)}))),function(t){return n.apply(this,arguments)})},{key:"filterView_",value:function(t){var e=t.detail.filter,n=qt().lineSubscriptions.map((function(t){return t.line})),i=this.querySelectorAll(Dt),r=this.querySelector(Mt);e?(i.forEach((function(t){n.includes(t.getAttribute("line"))||t.setAttribute("hidden","")})),n.length||this.renderMessage_()):(i.forEach((function(t){t.hasAttribute("hidden")&&t.removeAttribute("hidden")})),r&&this.removeChild(r))}},{key:"renderMessage_",value:function(){var t=G("div",{classname:Ut,copy:"There are currently no subscriptions"});this.appendChild(t)}},{key:"appReady_",value:function(){var t=qt(),e=t.notificationsFeature,n=t.userProfile.signedIn;(document.querySelector(Rt).classList.remove(Bt),document.querySelector(Wt).classList.remove(Bt),n)&&(this.querySelectorAll(jt).forEach((function(t){return t.classList.remove(Bt)})),document.querySelector(Ht).classList.remove(Bt));e||document.querySelector(Kt).classList.remove(Bt),document.dispatchEvent(new CustomEvent(vt)),this.classList.remove(Bt),window.location.href.includes("privacy")&&document.dispatchEvent(new CustomEvent(bt)),console.log(qt())}},{key:"handleError_",value:function(t){console.error(t),alert("Unable to retrieve API data.")}},{key:"disconnectedCallback",value:function(){document.removeEventListener(ft,this.filterView_)}}]),e}(_()(HTMLElement)),Jt="tube-status-tooltip",Yt="tube-status-tooltip__message",zt=function(t){function e(t,n){var i;return c()(this,e),(i=h()(this,f()(e).call(this))).message_=t,i.styles_=n,i}return b()(e,t),l()(e,[{key:"connectedCallback",value:function(){this.classList.add(Jt),this.render_()}},{key:"render_",value:function(){var t=G("div",{classname:Yt,copy:this.message_});for(var e in this.styles_)Object.prototype.hasOwnProperty.call(this.styles_,e)&&(this.style[e]=this.styles_[e]);this.appendChild(t)}}]),e}(_()(HTMLElement)),Vt=L.subscribeToStore,Qt=L.getStore,Xt=L.updateStore,Zt=".tube-status__filter-toggle--on",$t=".tube-status-tooltip",te=".tube-line-sub__image-wrapper",ee=".tube-status-toast",ne="tube-status-wrapper",ie="tube-line-sub__status",re="tube-line-sub__image",ae="tube-line-sub__image-wrapper",se="tube-line-info__reason-title",oe="tube-line--active",ce="tube-status-hide",ue=function(t){function e(){var t;return c()(this,e),(t=h()(this,f()(e).call(this))).line_=t.getAttribute("line"),t.tubeStatusWrapper_,t.subStatusEl_=t.querySelector(".".concat(ie)),t.subIconWrapper_=t.querySelector(te),t.subIconEl_=t.querySelector(".".concat(re)),t.reasonTitleEl_=t.querySelector(".".concat(se)),t.connectedCalled_=!1,t}var n;return b()(e,t),l()(e,[{key:"connectedCallback",value:function(){this.connectedCalled_||(Vt([{callback:this.updateTubeLineContent_.bind(this),action:X},{callback:this.toggleSubscriptionIcon_.bind(this),action:nt},{callback:this.toggleSubscriptionIcon_.bind(this),action:it},{callback:this.toggleSubscriptionIcon_.bind(this),action:ot},{callback:this.hideSubscritpionIcons_.bind(this),action:ot}]),this.addEventListener("click",this.handleClick_.bind(this)),this.addEventListener("keyup",this.handleKeyup_.bind(this)),this.addEventListener("keypress",this.handleKeyPress_.bind(this)),this.subIconWrapper_.addEventListener("keyup",this.handleKeyup_.bind(this)),this.subIconWrapper_.addEventListener("keypress",this.handleKeyPress_.bind(this)),this.subIconEl_.addEventListener("mouseover",this.toggleTooltip_.bind(this)),this.subIconEl_.addEventListener("mouseout",this.toggleTooltip_.bind(this)),this.tubeStatusWrapper_=document.querySelector(".".concat(ne)),this.connectedCalled_=!0)}},{key:"emit_",value:function(){var t={detail:{line:this.line_}};document.dispatchEvent(new CustomEvent(dt,t))}},{key:"handleSubClick_",value:function(){var t=Qt().userProfile.signedIn;"subscribe"===this.subIconWrapper_.getAttribute("type")?this.handleSubscribe_():t&&this.handleUnSubscribeRequest_()}},{key:"handleSubscribe_",value:function(){var t=Qt(),e=t.notificationsFeature,n=t.userProfile.signedIn;e&&n&&this.emit_()}},{key:"handleUnSubscribeRequest_",value:(n=s()(r.a.mark((function t(){var e,n,i,a,s,o,c;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e={detail:{filter:!0}},n=Qt(),i=n.notificationsFeature,a=document.querySelector(Zt),s=document.querySelector(ee),i){t.next=6;break}return t.abrupt("return");case 6:return Xt({action:tt,data:{loadingState:{state:!0,line:this.line_}}}),t.next=9,A(this.line_);case 9:if(o=t.sent,!(c=o.subscription)){t.next=17;break}return t.next=14,new Promise((function(t){return setTimeout(t,500)}));case 14:Xt({action:it,data:{lineSubscriptions:Y(c)}}),t.next=18;break;case 17:this.handleError_(o);case 18:Xt({action:tt,data:{loadingState:{state:!1,line:this.line_}}}),a.classList.contains(ce)||document.dispatchEvent(new CustomEvent(ft,e)),s.setAttribute("unsubscribe","");case 21:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"hideSubscritpionIcons_",value:function(){this.subIconEl_.classList.add(ce)}},{key:"handleKeyup_",value:function(t){t.stopImmediatePropagation(),9===t.which&&V(t.target)}},{key:"handleKeyPress_",value:function(t){t.stopImmediatePropagation(),13===t.which&&this.handleClick_(t)}},{key:"toggleTooltip_",value:function(t){var e,n=Qt().notificationsFeature,i={top:"-18px",left:"50px"},r=this.subIconWrapper_.getAttribute("type");if("mouseout"!==t.type)e=new zt(n?"subscribe"===r?xt:It:Ct,i),this.subIconWrapper_.appendChild(e);else{var a=document.querySelector($t);a.parentNode.removeChild(a)}}},{key:"handleClick_",value:function(t){var e=t.target,n={detail:{line:this.line_}},i=this.classList.contains(oe),r=e.classList.contains(re)||e.classList.contains(ae);i&&(r?this.handleSubClick_(t):document.dispatchEvent(new CustomEvent(ut,n)))}},{key:"updateTubeLineContent_",value:function(){var t=this,e=Qt().lineInformation,n=z(e[this.line_]),i=n[0],r=i.status,a=i.reason;this.subStatusEl_.textContent="".concat(this.line_),this.reasonTitleEl_.textContent="",this.setScoreAttribute_(r),a?this.classList.add(oe):this.classList.remove(oe),n.forEach((function(e,i){var r=e.status,a=i===n.length-1?"":" | ";t.reasonTitleEl_.textContent+=" ".concat(r," ").concat(a)}))}},{key:"toggleSubscriptionIcon_",value:function(){var t,e;Object.keys((t=this.line_,e=U().lineSubscriptions.filter((function(e){return e.line===t})),e.length?e[0]:{})).length?(this.subIconEl_.src="/images/unsubscribe.svg",this.subIconWrapper_.setAttribute("type","unsubscribe")):(this.subIconEl_.src="/images/subscribe.svg",this.subIconWrapper_.setAttribute("type","subscribe"))}},{key:"setScoreAttribute_",value:function(t){switch(t){case yt:case _t:this.setAttribute("score","6");break;case mt:case gt:this.setAttribute("score","5");break;case Et:this.setAttribute("score","4");break;case kt:this.setAttribute("score","3");break;case St:case Lt:this.setAttribute("score","2");break;case wt:this.setAttribute("score","1")}}},{key:"handleError_",value:function(t){console.error("Unable to subscribe to line at this time. ".concat(t))}},{key:"disconnectedCallback",value:function(){this.removeEventListener("click",this.handleClick_),this.removeEventListener("keyup",this.handleKeyup_),this.removeEventListener("keypress",this.handleKeyPress_),this.subIconEl_.removeEventListener("mouseover",this.toggleTooltip_.bind(this)),this.subIconEl_.removeEventListener("mouseout",this.toggleTooltip_.bind(this))}}]),e}(_()(HTMLElement)),le=L.updateStore,de=L.subscribeToStore,he=L.getStore,pe=".tube-status-authentication__image",fe=".tube-status-header__subscription ",ve="tube-status-authentication",be="tube-status-authentication__btn",ye="tube-status-hide",_e="tube-status-btn",me=function(t){function e(){var t;return c()(this,e),(t=h()(this,f()(e).call(this))).dest_=t.getAttribute("dest"),t.authPath_=t.getAttribute("auth-path"),t.signInImageEl_=t.querySelector(pe),t.token_=localStorage.getItem("JWT"),t.connectedCalled_=!1,t}var n;return b()(e,t),l()(e,[{key:"connectedCallback",value:function(){this.connectedCalled_||(de({callback:this.attemptAttrUpdate_.bind(this),action:Z}),this.classList.add(ve),this.addEventListener("keyup",this.handleKeyup_.bind(this)),this.addEventListener("keypress",this.handleKeyPress_.bind(this)),this.addEventListener("click",this.handleAuth_.bind(this)),this.handleJWT_(),this.connectedCalled_=!0)}},{key:"handleKeyup_",value:function(t){t.stopImmediatePropagation(),9===t.which&&V(this)}},{key:"handleKeyPress_",value:function(t){t.stopImmediatePropagation(),13===t.which&&this.handleAuth_(t)}},{key:"handleJWT_",value:function(){if(this.token_){var t=JSON.parse(window.atob(this.token_.split(".")[1])),e=t.photos,n=t.id;le({action:Z,data:{signedIn:!0,avatar:e[0].value,id:n}})}}},{key:"attemptAttrUpdate_",value:function(){if(he().userProfile.signedIn){var t=G("span",{copy:"Sign out",classname:[be,_e]});this.setAttribute("auth-path","Sign out"),this.signInImageEl_.classList.add(ye),this.appendChild(t)}else{var e=this.querySelector(".".concat(be));this.setAttribute("auth-path","Sign in"),this.signInImageEl_.classList.remove(ye),document.querySelector(fe).classList.add(ye),this.removeChild(e)}this.authPath_=this.getAttribute("auth-path")}},{key:"handleAuth_",value:function(t){t.stopPropagation(),"Sign in"===this.authPath_?this.handleSignIn_():this.handleLogout_()}},{key:"handleSignIn_",value:function(){this.classList.add(ye),le({action:et,data:{loadingState:{state:!0,line:null}}}),window.location.href=this.dest_}},{key:"handleLogout_",value:(n=s()(r.a.mark((function t(){var e;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.authPath_="Sign in",this.querySelector(".".concat(be)).classList.add(ye),le({action:et,data:{loadingState:{state:!0,line:null}}}),t.next=5,x();case 5:if(200!==(e=t.sent)){t.next=16;break}return t.next=9,new Promise((function(t){return setTimeout(t,300)}));case 9:localStorage.removeItem("JWT"),le({action:Z,data:{signedIn:!1,avatar:null,id:null}}),le({action:et,data:{loadingState:{state:!1,line:null}}}),le({action:ot}),console.log(L.getStore()),t.next=17;break;case 16:this.handleError_(e);case 17:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"handleError_",value:function(t){console.error("Unable to subscribe to line at this time. ".concat(t))}},{key:"disconnectedCallback",value:function(){this.removeEventListener("click",this.handleAuth_),this.removeEventListener("keyup",this.handleKeyup_),this.removeEventListener("keypress",this.handleKeyPress_)}}]),e}(_()(HTMLElement)),ge=L.subscribeToStore,Ee=L.getStore,ke="tube-status-loading--active",Se="tube-status-loading--active-line",we="tube-status-loading--active-header",Le="app-wrapper--hidden",xe=".app-wrapper",Ce=function(t){function e(){var t;return c()(this,e),(t=h()(this,f()(e).call(this))).appWrapper_,t.line_=t.parentElement.parentElement.getAttribute("line"),t.connectedCalled_=!1,t}return b()(e,t),l()(e,[{key:"connectedCallback",value:function(){if(!this.connectedCalled_){var t,e,n=this.hasAttribute("app"),i=this.hasAttribute("header");this.appWrapper_=document.querySelector(xe),n?(t=$,e=this.handleLoadingApp_.bind(this)):i?(t=et,e=this.handleLoadingHeader_.bind(this)):(t=tt,e=this.handleLoadingLine_.bind(this)),ge({callback:e,action:t}),this.connectedCalled_=!0}}},{key:"handleLoadingApp_",value:function(){Ee().loadingState.state?(this.appWrapper_.classList.add(Le),this.classList.add(ke)):(this.appWrapper_.classList.remove(Le),this.classList.remove(ke))}},{key:"handleLoadingLine_",value:function(){var t=Ee().loadingState,e=t.state,n=t.line,i=this.classList;this.line_===n&&(e?i.add(Se):i.remove(Se))}},{key:"handleLoadingHeader_",value:function(){var t=Ee().loadingState.state,e=this.classList;t?e.add(we):e.remove(we)}}]),e}(_()(HTMLElement)),Ie=L.getStore,Te=L.updateStore,Ae=L.subscribeToStore,Pe="tube-status-modal--active",Oe="tube-status-modal--subscribe",Ne="tube-status-modal__caption",qe="tube-status-modal__reason",De="tube-status-modal__icon",je="dim",Me="tube-status-modal-sub",Re="tube-status-modal-sub__title",We="tube-status-modal-sub__select",He="tube-status-modal-sub__btn",Ke="tube-status-modal-sub__btn-times",Ue="tube-status-modal-sub__btn-days",Fe="tube-status-btn--selected",Be="tube-status-week",Ge="tube-status-time",Je="tube-status-btn",Ye=".overlay",ze=".tube-status-toast",Ve=function(t){function e(){var t;return c()(this,e),(t=h()(this,f()(e).call(this))).overlay_,t.line_,t}var n;return b()(e,t),l()(e,[{key:"connectedCallback",value:function(){this.overlay_=document.querySelector(Ye);var t=[{callback:this.updateSelectDaysBtn_.bind(this),action:rt},{callback:this.updateSelectTimesBtn_.bind(this),action:at}];Ae(t),document.addEventListener(ut,this.toggleModal_.bind(this)),document.addEventListener(dt,this.renderSubscriptionOptions_.bind(this))}},{key:"emit_",value:function(t){var e,n=t.target,i={detail:{line:this.line_}};e=n.classList.contains(Ue)?ht:pt,document.dispatchEvent(new CustomEvent(e,i))}},{key:"updateSelectDaysBtn_",value:function(){var t=Ie().selectedSubscriptionWindow,e=t.days,n=t.hours,i=this.querySelector(".".concat(Ue));e&&(e.length?(i.textContent="Days selected",i.classList.add(Fe),n&&(this.querySelector(".".concat(He)).disabled=!1)):(i.textContent="Select days",i.classList.remove(Fe)))}},{key:"updateSelectTimesBtn_",value:function(){var t=Ie().selectedSubscriptionWindow,e=t.hours,n=t.days,i=this.querySelector(".".concat(Ke));e&&(e.length?(i.textContent="Times selected",i.classList.add(Fe),n&&(this.querySelector(".".concat(He)).disabled=!1)):(i.textContent="Select times",i.classList.remove(Fe)))}},{key:"renderSubscriptionOptions_",value:function(t){var n=[{type:"click",fn:this.emit_.bind(this)},{type:"keyup",fn:V}],i=[{type:"click",fn:this.handleSubscriptionRequest_.bind(this)},{type:"keyup",fn:V}],r=G("div",{classname:Me}),a=G("div",{classname:We}),s=G("div",{classname:Re,copy:"Specify your subscription times:"}),o=G("button",{copy:"Select days",classname:[Ue,Je],event:n,data:{name:"tabindex",value:"0"}}),c=G("button",{copy:"Select times",classname:[Ke,Je],event:n,data:{name:"tabindex",value:"0"}}),u=G("button",{copy:"Subscribe",classname:[He,Je],event:i,data:[{name:"tabindex",value:"0"},{name:"disabled",value:""}]});this.line_=t.detail.line,this.overlay_.classList.add(je),this.classList.add(Pe),this.classList.add(Oe),this.appendChild(e.createModalIcon(this.toggleModal_.bind(this))),a.appendChild(o),a.appendChild(c),[s,a,u].forEach((function(t){return r.appendChild(t)})),this.appendChild(r),this.setAttribute("tabindex","0"),this.focus(),Q(this)}},{key:"handleSubscriptionRequest_",value:(n=s()(r.a.mark((function t(e){var n,i,a,s,o,c,u;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=Ie(),i=n.userProfile,a=n.pushSubscription,s=n.selectedSubscriptionWindow,!i.signedIn||!a){t.next=21;break}return t.next=4,T(a,this.line_,s);case 4:if(o=t.sent,c=o.subscription,u=document.querySelector(ze),!c.length){t.next=18;break}return this.toggleModal_(),Te({action:tt,data:{loadingState:{state:!0,line:this.line_}}}),t.next=12,new Promise((function(t){return setTimeout(t,500)}));case 12:Te({action:tt,data:{loadingState:{state:!1,line:this.line_}}}),Te({action:nt,data:{lineSubscriptions:Y(c)}}),Te({action:st,data:{days:null,hours:null}}),u.setAttribute("subscribe",""),t.next=19;break;case 18:this.handleError_(o);case 19:t.next=22;break;case 21:this.handleError_("Push subscription object not found");case 22:case"end":return t.stop()}}),t,this)}))),function(t){return n.apply(this,arguments)})},{key:"populateModal_",value:function(t){var e=this,n=G("div",{classname:Ne});t.forEach((function(t){var i=t.reason,r=n.textContent.trimLeft()===i,a=G("div",{classname:qe});r||(a.textContent+=" ".concat(i),n.appendChild(a)),e.renderDelayContext_(n)})),this.setAttribute("tabindex","0"),this.focus()}},{key:"toggleModal_",value:function(t){var e=t?t.which:null,n=t?t.type:null,i=document.querySelector(".".concat(De));if("line-click"===n||"click"===n||13===e||!t){var r=Ie().lineInformation,a=t?t.detail.line:null;this.removeContent_(),a?(this.overlay_.classList.add(je),this.classList.add(Pe),this.populateModal_(z(r[a])),Q(this)):(this.overlay_.classList.remove(je),this.classList.remove(Pe),this.classList.remove(Oe),document.dispatchEvent(new CustomEvent(lt)))}else 9===e&&V(i)}},{key:"renderDelayContext_",value:function(t){this.querySelector(".".concat(Ne))?(this.removeContent_(),this.appendChild(e.createModalIcon(this.toggleModal_.bind(this))),this.appendChild(t)):(this.appendChild(e.createModalIcon(this.toggleModal_.bind(this))),this.appendChild(t))}},{key:"removeContent_",value:function(){var t=this;Array.from(this.childNodes).filter((function(t){var e=t.nodeName.toLowerCase();if(![Be,Ge].includes(e))return t})).forEach((function(e){return t.removeChild(e)})),Te({action:st,data:{days:null,hours:null}})}},{key:"handleError_",value:function(t){console.error("".concat(Tt," ").concat(t))}},{key:"disconnectedCallback",value:function(){document.removeEventListener(ut,this.toggleModal_),document.removeEventListener(dt,this.renderSubscriptionOptions_.bind(this))}}],[{key:"createModalIcon",value:function(t){return G("div",{classname:De,event:[{type:"click",fn:t},{type:"keyup",fn:t},{type:"keypress",fn:t}],data:{name:"tabindex",value:"0"}})}}]),e}(_()(HTMLElement)),Qe=L.subscribeToStore,Xe=L.getStore,Ze="tube-status-hide",$e="tube-status-avatar__dropdown-download-btn",tn="tube-status-header__avatar-image",en="tube-status-avatar__dropdown-delete-btn",nn="tube-status-header__profile--signed-in",rn="tube-status-avatar__btn-block",an="tube-status-temp-anchor",sn="tube-status-header--open",on="tube-status-btn",cn="tube-status-btn--danger",un=".tube-status-header__avatar",ln=".tube-status-header__avatar-image",dn=".tube-status-header__profile",hn=".tube-status-authentication",pn=".tube-status-toast",fn=function(t){function e(){var t;return c()(this,e),(t=h()(this,f()(e).call(this))).avatarEl_=t.querySelector(ln),t.profileEl_=t.querySelector(dn),t.authenticationEl_=t.querySelector(hn),t.avatarWrapperEl_=t.querySelector(un),t}var n,i;return b()(e,t),l()(e,[{key:"connectedCallback",value:function(){Qe([{callback:this.updateAvatar_.bind(this),action:Z},{callback:this.toggleDropdown_.bind(this),action:ot}]),document.addEventListener("click",this.toggleDropdown_.bind(this)),this.avatarWrapperEl_.addEventListener("keyup",this.handleKeyup_.bind(this)),this.avatarWrapperEl_.addEventListener("keypress",this.handleKeyPress_.bind(this)),this.updateAvatar_()}},{key:"handleKeyup_",value:function(t){t.stopImmediatePropagation(),9===t.which&&V(t.target)}},{key:"handleKeyPress_",value:function(t){t.stopImmediatePropagation(),"BUTTON"!==t.target.tagName&&13===t.which&&this.toggleDropdown_(t)}},{key:"updateAvatar_",value:function(){var t=Xe().userProfile,e=t.signedIn,n=t.avatar;"safari"in window!=!0&&(this.profileEl_.classList.remove(Ze),this.avatarEl_.src=e?n:"/images/account_circle.svg",e&&this.profileEl_.classList.add(nn))}},{key:"removeContent_",value:function(){var t=this;Array.from(this.avatarWrapperEl_.children).forEach((function(e){e.classList.contains(tn)||t.avatarWrapperEl_.removeChild(e)})),this.avatarEl_.removeAttribute("tabindex"),this.classList.remove(sn)}},{key:"handleRemoveRequest_",value:(i=s()(r.a.mark((function t(e){var n;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.stopImmediatePropagation(),n=document.querySelector(pn),t.next=4,I();case 4:200===t.sent&&(this.removeContent_(),this.authenticationEl_.click(),n.setAttribute("delete",""));case 6:case"end":return t.stop()}}),t,this)}))),function(t){return i.apply(this,arguments)})},{key:"handleDownloadRequest_",value:(n=s()(r.a.mark((function t(e){var n,i,a,s,o;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.stopImmediatePropagation(),n=this.querySelector(".".concat(rn)),t.next=4,C().catch(this.handleError_);case 4:return i=t.sent,t.next=7,i.blob().catch(this.handleError_);case 7:a=t.sent,s=window.URL.createObjectURL(a),(o=G("a",{data:{name:"href",value:s},classname:an})).style.display="none",o.download="data.txt",n.appendChild(o),o.click(),window.URL.revokeObjectURL(s),n.removeChild(n.querySelector(".".concat(an)));case 16:case"end":return t.stop()}}),t,this)}))),function(t){return n.apply(this,arguments)})},{key:"toggleDropdown_",value:function(t){if(t){var e=t.target,n=this.querySelector(".".concat(an)),i=this.querySelector(".".concat(rn)),r=e!==n&&e!==i,a=e===this.avatarEl_||e===this.avatarWrapperEl_;if(!a&&r)return void this.removeContent_();if(!a&&!r)return}var s=Xe().userProfile.signedIn,o=this.querySelector(".".concat($e));if(s){if(o)return void this.removeContent_();this.createDropdown_()}else this.removeContent_(),this.profileEl_.classList.remove(nn)}},{key:"createDropdown_",value:function(){var t=G("div",{classname:rn}),e=[{type:"click",fn:this.handleDownloadRequest_.bind(this)},{type:"keyup",fn:V}],n=[{type:"click",fn:this.handleRemoveRequest_.bind(this)},{type:"keyup",fn:V}],i=G("button",{classname:[$e,on],copy:"Download data",event:e,data:{name:"tabindex",value:"0"}}),r=G("button",{classname:[en,on,cn],copy:"Delete account",event:n,data:{name:"tabindex",value:"0"}});t.appendChild(i),t.appendChild(r),this.avatarWrapperEl_.appendChild(t),this.classList.add(sn),this.avatarEl_.setAttribute("tabindex","0"),this.avatarWrapperEl_.focus(),Q(this.avatarWrapperEl_)}},{key:"handleError_",value:function(t){console.error("We are currently unable to handle this request. ".concat(t))}},{key:"disconnectedCallback",value:function(){document.removeEventListener("click",this.toggleDropdown_),this.avatarWrapperEl_.removeEventListener("keyup",this.handleKeyup_),this.avatarWrapperEl_.removeEventListener("keypress",this.handleKeyPress_)}}]),e}(_()(HTMLElement)),vn=L.updateStore,bn=L.getStore,yn="tube-status-week--active",_n="tube-status-week-day",mn="tube-status-week-day__select",gn="tube-status-week-day__select--active",En="tube-status-week__btn",kn="tube-status-modal-sub__btn-times",Sn="tube-status-btn",wn=function(t){function e(){var t;return c()(this,e),(t=h()(this,f()(e).call(this))).line_,t.days_=[],t.markupExists_=!1,t}return b()(e,t),l()(e,[{key:"connectedCallback",value:function(){document.addEventListener(ht,this.initHandler_.bind(this)),document.addEventListener(lt,this.reset_.bind(this)),document.addEventListener("click",this.reset_.bind(this))}},{key:"handlePreselect_",value:function(){var t=this,e=bn().selectedSubscriptionWindow.days,n=this.querySelector(".".concat(En)),i=Array.from(this.querySelectorAll(".".concat(mn)));this.days_=e,i.forEach((function(e){t.days_.includes(e.getAttribute("day"))&&e.classList.add(gn)})),n.disabled=!1}},{key:"initHandler_",value:function(t){var e=bn().selectedSubscriptionWindow.days;this.markupExists_?this.reset_():(this.render_(t),e&&this.handlePreselect_())}},{key:"handleSubmitDays_",value:function(){var t=bn().selectedSubscriptionWindow.hours;vn({action:rt,data:{days:this.days_,hours:t}}),this.reset_()}},{key:"reset_",value:function(t){var e=this,n=Array.from(this.childNodes);if(t){var i=t.target;if(i.classList&&!i.classList.contains(kn))return}this.classList.remove(yn),this.removeAttribute("tabindex"),this.days_=[],this.markupExists_=!1,n.forEach((function(t){return e.removeChild(t)}))}},{key:"render_",value:function(t){var e=this,n=[{type:"click",fn:this.handleSubmitDays_.bind(this)},{type:"keyup",fn:V}],i=G("button",{classname:[En,Sn],event:n,data:[{name:"tabindex",value:"0"},{name:"disabled",value:""}],copy:"Submit days"}),r=G("table"),a=G("thead"),s=G("tbody"),o=G("tr"),c=J("day").map((function(t){return G("th",{classname:_n,copy:t})}));this.line_=t.detail.line,this.classList.add(yn),c.forEach((function(t){var n=[{name:"day",value:t.innerText},{name:"tabindex",value:"0"}],i=[{type:"click",fn:e.handleDayClick_.bind(e)},{type:"keydown",fn:e.handleDayClick_.bind(e)},{type:"keyup",fn:V}],r=G("td",{classname:mn,data:n,event:i});a.appendChild(t),o.appendChild(r)})),r.appendChild(a),s.appendChild(o),r.appendChild(s),this.appendChild(r),this.appendChild(i),this.markupExists_=!0,this.setAttribute("tabindex","0"),this.focus(),Q(this)}},{key:"handleDayClick_",value:function(t){var e=t.target,n=t.which,i=t.type,r=this.querySelector(".".concat(En));if("click"===i||13===n){var a=e.getAttribute("day");e.classList.contains(gn)?(e.classList.remove(gn),this.days_=this.days_.filter((function(t){return a!==t})),this.days_.length||(r.disabled=!0)):(e.classList.add(gn),this.days_=this.days_.includes(a)?[a]:[].concat(g()(this.days_),[a]),r.disabled=!1)}}},{key:"disconnectedCallback",value:function(){document.removeEventListener(ht,this.initHandler_),document.removeEventListener(lt,this.reset_),document.removeEventListener("click",this.reset_)}}]),e}(_()(HTMLElement)),Ln=L.updateStore,xn=L.getStore,Cn="tube-status-time--active",In="tube-status-time-hour",Tn="tube-status-time-hour__select",An="tube-status-time-hour__select--active",Pn="tube-status-time__btn",On="tube-status-modal-sub__btn-days",Nn="tube-status-time__table-wrapper",qn="tube-status-btn",Dn=function(t){function e(){var t;return c()(this,e),(t=h()(this,f()(e).call(this))).line_,t.hours_=[],t.markupExists_=!1,t}return b()(e,t),l()(e,[{key:"connectedCallback",value:function(){document.addEventListener(pt,this.initHandler_.bind(this)),document.addEventListener(lt,this.reset_.bind(this)),document.addEventListener("click",this.reset_.bind(this))}},{key:"handlePreselect_",value:function(){var t=this,e=xn().selectedSubscriptionWindow.hours,n=this.querySelector(".".concat(Pn)),i=Array.from(this.querySelectorAll(".".concat(Tn)));this.hours_=e,i.forEach((function(e){t.hours_.includes(+e.getAttribute("hour"))&&e.classList.add(An)})),n.disabled=!1}},{key:"initHandler_",value:function(t){var e=xn().selectedSubscriptionWindow.hours;this.markupExists_?this.reset_():(this.render_(t),e&&this.handlePreselect_())}},{key:"handleSubmitHours_",value:function(){var t=xn().selectedSubscriptionWindow.days;Ln({action:at,data:{days:t,hours:this.hours_}}),this.reset_()}},{key:"reset_",value:function(t){var e=this,n=Array.from(this.childNodes);if(t){var i=t.target;if(i.classList&&!i.classList.contains(On))return}this.classList.remove(Cn),this.removeAttribute("tabindex"),this.hours_=[],this.markupExists_=!1,n.forEach((function(t){return e.removeChild(t)}))}},{key:"render_",value:function(t){var e=this,n=[{type:"click",fn:this.handleSubmitHours_.bind(this)},{type:"keyup",fn:V}],i=G("button",{classname:[Pn,qn],copy:"Submit time range",data:[{name:"tabindex",value:"0"},{name:"disabled",value:""}],event:n}),r=G("div",{classname:Nn}),a=G("table"),s=G("thead"),o=G("tbody"),c=G("tr"),u=J("hours").map((function(t){return G("th",{classname:In,copy:t})}));this.line_=t.detail.line,this.classList.add(Cn),u.forEach((function(t){var n=[{name:"hour",value:t.innerText},{name:"tabindex",value:"0"}],i=[{type:"click",fn:e.handleHourClick_.bind(e)},{type:"keydown",fn:e.handleHourClick_.bind(e)},{type:"keyup",fn:V}],r=G("td",{classname:Tn,data:n,event:i});s.appendChild(t),c.appendChild(r)})),a.appendChild(s),o.appendChild(c),a.appendChild(o),r.appendChild(a),this.appendChild(r),this.appendChild(i),this.markupExists_=!0,this.setAttribute("tabindex","0"),this.focus(),Q(this)}},{key:"handleHourClick_",value:function(t){var e=this,n=t.target,i=t.which,r=t.type,a=this.querySelector(".".concat(Pn));if("click"===r||13===i){var s=+n.getAttribute("hour");if(n.classList.contains(An))this.querySelectorAll("\n          .".concat(An)).forEach((function(t){return t.classList.remove(An)})),this.hours_=[],this.hours_.length||(a.disabled=!0);else n.classList.add(An),this.hours_.length?(this.hours_=this.createRange_(s),this.hours_.forEach((function(t){e.querySelector('[hour="'.concat(t,'"]')).classList.add(An)})),a.disabled=!1):this.hours_=[s]}}},{key:"createRange_",value:function(t){for(var e=[].concat(g()(this.hours_),[t]).sort((function(t,e){return t-e})),n=[e[0]],i=e[e.length-1]-e[0]-1,r=0;r<=i;r++)n.push(n[n.length-1]+1);return n}},{key:"disconnectedCallback",value:function(){document.removeEventListener(pt,this.initHandler_),document.removeEventListener(lt,this.reset_),document.removeEventListener("click",this.reset_)}}]),e}(_()(HTMLElement)),jn=L.getStore,Mn=L.subscribeToStore,Rn="tube-status-subscriptions__dropdown",Wn="tube-status-subscriptions__heading",Hn="tube-status-subscriptions__line",Kn="tube-status-subscriptions__line-name",Un="tube-status-subscriptions__line-color",Fn="tube-status-subscriptions__notifcation",Bn="tube-status-header__subscription-image",Gn=".tube-status-header__subscription-image",Jn=function(t){function e(){var t;return c()(this,e),(t=h()(this,f()(e).call(this))).subIconEl_,t}return b()(e,t),l()(e,[{key:"connectedCallback",value:function(){Mn([{callback:this.renderNotificationIcon_.bind(this),action:nt},{callback:this.renderNotificationIcon_.bind(this),action:it},{callback:this.removeContent_.bind(this),action:ot}]),document.addEventListener("click",this.toggleSubscriptions_.bind(this)),this.addEventListener("keyup",this.handleKeyup_.bind(this)),this.addEventListener("keypress",this.handleKeyPress_.bind(this)),this.subIconEl_=this.querySelector(Gn)}},{key:"handleKeyup_",value:function(t){9===t.which&&V(this)}},{key:"handleKeyPress_",value:function(t){13===t.which&&this.toggleSubscriptions_(t)}},{key:"dropdownExists_",value:function(){return Array.from(this.children).some((function(t){return t.classList.contains(Rn)}))}},{key:"renderNotificationIcon_",value:function(){var t=jn().lineSubscriptions,e=this.querySelector(".".concat(Fn));if(t.length){e&&this.removeChild(e);var n=G("div",{classname:Fn,copy:t.length});this.appendChild(n)}}},{key:"updateIcon_",value:function(){this.dropdownExists_()?this.subIconEl_.src="/images/subscriptions.svg":this.subIconEl_.src="/images/subscriptions-filled.svg"}},{key:"toggleSubscriptions_",value:function(t){if(jn().userProfile.signedIn){var e=t.target,n=t.which;e.parentNode!==this&&!(13===n)?this.dropdownExists_()&&(this.updateIcon_(),this.removeContent_()):(this.updateIcon_(),this.dropdownExists_()?this.removeContent_():this.renderSubscriptionList_())}}},{key:"renderSubscriptionList_",value:function(){this.removeContent_();var t=jn().lineSubscriptions,e=t.length?"Subscriptions":"No subscriptions",n=G("div",{classname:Rn}),i=G("h2",{classname:Wn,copy:e});n.appendChild(i),t.forEach((function(t){var e=G("div",{classname:Hn}),i=G("span",{classname:Kn,copy:t.line}),r=G("span",{classname:"".concat(Un,"-").concat(t.line)});e.appendChild(i),e.appendChild(r),n.appendChild(e)})),this.appendChild(n)}},{key:"removeContent_",value:function(){var t=this,e=L.getStore().userProfile.signedIn;Array.from(this.children).filter((function(t){var n=t.classList.contains(Bn),i=t.classList.contains(Fn);if(e?!n&&!i:!n)return t})).forEach((function(e){return t.removeChild(e)}))}},{key:"disconnectedCallback",value:function(){this.removeEventListener("click",this.toggleSubscriptions_),this.removeEventListener("keyup",this.handleKeyup_),this.removeEventListener("keypress",this.handleKeyPress_)}}]),e}(_()(HTMLElement)),Yn=L.subscribeToStore,zn=L.getStore,Vn=".tube-status__filter-toggle .material-icons",Qn=".tube-status__filter-toggle",Xn="tube-status-filter--active",Zn="tube-status-hide",$n=function(t){function e(){var t;return c()(this,e),(t=h()(this,f()(e).call(this))).filter_=!1,t.toggleIconEls_=t.querySelectorAll(Vn),t.filterToggle_=t.querySelector(Qn),t}return b()(e,t),l()(e,[{key:"connectedCallback",value:function(){var t=this;Yn({callback:this.toggleDisplay_.bind(this),action:Z}),this.toggleIconEls_.forEach((function(e){e.addEventListener("click",t.handleClick_.bind(t))})),this.addEventListener("keyup",this.handleKeyup_.bind(this)),this.addEventListener("keypress",this.handleKeyPress_),document.addEventListener(vt,this.toggleDisplay_.bind(this))}},{key:"handleKeyup_",value:function(t){9===t.which&&V(this.filterToggle_)}},{key:"handleKeyPress_",value:function(t){13===t.which&&(this.emit_(),this.toggleIcon_())}},{key:"handleClick_",value:function(t){this.emit_(),this.toggleIcon_()}},{key:"toggleDisplay_",value:function(){zn().userProfile.signedIn?this.classList.add(Xn):this.classList.remove(Xn)}},{key:"emit_",value:function(){this.filter_=!this.filter_;var t={detail:{filter:this.filter_}};document.dispatchEvent(new CustomEvent(ft,t))}},{key:"toggleIcon_",value:function(){this.toggleIconEls_.forEach((function(t){t.classList.contains(Zn)?t.classList.remove(Zn):t.classList.add(Zn)}))}},{key:"disconnectedCallback",value:function(){this.removeEventListener("click",this.handleClick_),this.removeEventListener("keyup",this.handleKeyup_),this.removeEventListener("keypress",this.handleKeyPress_)}}]),e}(_()(HTMLElement)),ti={HEADING:{TITLE:"Privacy Policy",CONTENT:"This privacy policy explains how we collect personal information about you, and how we use it."},INFORMATION:{TITLE:"Social Login",CONTENT:"Information is only collected from you when you choose to sign into this website using your Google account. By doing so, you authorise us to collect, store and use any information they may give us (e.g., your email address)."},SITE_SECURITY:{TITLE:"Site security",CONTENT:"Any information you provide on this website is protected by encryption. This site is securely served over HTTPS."},NOTIFICATIONS:{TITLE:"Notification alerts",CONTENT:"You can unsubscribe from individual line notifications at any time by clicking the bell icon on a given tube line that you are subscribed to."},MY_DATA:{TITLE:"Retrieving data",CONTENT:"You can request a .txt file containing all of the data we have collected from you. To do so, click your avatar/profile image and select the 'download my data' option from the dropdown."},REMOVE_MY_DATA:{TITLE:"Deleting data",CONTENT:"You can delete your tube-status account at any time by clicking your avatar/profile and selecting the 'delete account' option from the dropdown. Deleting your account will remove all of the data we have stored and collected from you and automatically sign you out."},CONTACT:{TITLE:"Contact",CONTENT:"For any questions or concerns, please contact jrobind@outlook.com"}},ei="tube-status-modal--active",ni="tube-status-modal__icon",ii="tube-status-modal__caption",ri="tube-status-modal-privacy__block",ai="tube-status-modal-privacy__heading",si="tube-status-modal-privacy__content",oi="tube-status-privacy-modal__type",ci="dim",ui="tube-status-hide",li=".overlay",di=function(t){function e(){var t;return c()(this,e),(t=h()(this,f()(e).call(this))).overlay_,t.typeEl_=t.querySelector(".".concat(oi)),t}return b()(e,t),l()(e,[{key:"connectedCallback",value:function(){this.overlay_=document.querySelector(li),this.addEventListener("click",this.toggleModal_.bind(this)),this.addEventListener("keyup",this.handleKeyup_.bind(this)),this.addEventListener("keypress",this.handleKeyPress_.bind(this)),document.addEventListener(bt,this.toggleModal_.bind(this))}},{key:"handleKeyup_",value:function(t){t.stopImmediatePropagation(),9===t.which&&V(this)}},{key:"handleKeyPress_",value:function(t){t.stopImmediatePropagation(),13===t.which&&this.toggleModal_(t)}},{key:"populateModal_",value:function(){this.appendChild(Ve.createModalIcon(this.toggleModal_.bind(this)));var t=G("div",{classname:ii});Object.entries(ti).forEach((function(e){var n=e[1],i=n.TITLE,r=n.CONTENT,a=G("div",{classname:ri}),s=G("h2",{classname:ai,copy:i}),o=G("p",{classname:si,copy:r});a.appendChild(s),a.appendChild(o),t.appendChild(a)})),this.appendChild(t),this.focus()}},{key:"updateURL_",value:function(t){"set"===t?window.history.pushState(null,null,"/privacy"):window.history.pushState(null,null,"/")}},{key:"toggleModal_",value:function(t){t.stopImmediatePropagation();var e=t?t.which:null,n=t.target,i=this.querySelector(".".concat(ni));"click"===t.type&&i&&n!==i||(9===e&&i?V(i):(this.removeContent_(),i?(this.overlay_.classList.remove(ci),this.classList.remove(ei),this.typeEl_.classList.remove(ui),this.updateURL_(),document.dispatchEvent(new CustomEvent(lt))):(this.updateURL_("set"),this.overlay_.classList.add(ci),this.classList.add(ei),this.typeEl_.classList.add(ui),this.populateModal_(),Q(this))))}},{key:"removeContent_",value:function(){var t=this;Array.from(this.children).forEach((function(e){e.classList.contains(oi)||t.removeChild(e)}))}},{key:"disconnectedCallback",value:function(){document.removeEventListener("click",this.toggleModal_),document.removeEventListener(bt,this.toggleModal_.bind(this))}}]),e}(_()(HTMLElement)),hi="tube-status-toast__message",pi="tube-status-hide",fi=function(t){function e(){var t;return c()(this,e),(t=h()(this,f()(e).call(this))).messageEl_=t.querySelector(".".concat(hi)),t}var n;return b()(e,t),l()(e,[{key:"attributeChangedCallback",value:function(t,e,n){switch(t){case"delete":this.updateMessage_(At);break;case"subscribe":this.updateMessage_(Pt);break;case"unsubscribe":this.updateMessage_(Ot)}}},{key:"updateMessage_",value:(n=s()(r.a.mark((function t(e){return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.classList.remove(pi),this.messageEl_.textContent=e,t.next=4,new Promise((function(t){return setTimeout(t,4e3)}));case 4:this.classList.add(pi);case 5:case"end":return t.stop()}}),t,this)}))),function(t){return n.apply(this,arguments)})}],[{key:"observedAttributes",get:function(){return["delete","subscribe","unsubscribe","hide"]}}]),e}(_()(HTMLElement));window.customElements.define("tube-status-modal",Ve),window.customElements.define("tube-status-privacy-modal",di),window.customElements.define("tube-status-loading",Ce),window.customElements.define("tube-status-wrapper",Gt),window.customElements.define("tube-line",ue),window.customElements.define("tube-status-header",fn),window.customElements.define("tube-status-authentication",me),window.customElements.define("tube-status-week",wn),window.customElements.define("tube-status-time",Dn),window.customElements.define("tube-status-tooltip",zt),window.customElements.define("tube-status-subscriptions",Jn),window.customElements.define("tube-status-filter",$n),window.customElements.define("tube-status-toast",fi)}]);