!function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=19)}([function(t,e,n){t.exports=n(12)},function(t,e){function n(e){return t.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},n(e)}t.exports=n},function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},function(t,e){function n(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}t.exports=function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}},function(t,e,n){var i=n(10),r=n(13);t.exports=function(t,e){return!e||"object"!==i(e)&&"function"!=typeof e?r(t):e}},function(t,e,n){var i=n(9);t.exports=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&i(t,e)}},function(t,e,n){var i=n(1),r=n(9),s=n(14),a=n(15);function o(e){var n="function"==typeof Map?new Map:void 0;return t.exports=o=function(t){if(null===t||!s(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(t))return n.get(t);n.set(t,e)}function e(){return a(t,arguments,i(this).constructor)}return e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),r(e,t)},o(e)}t.exports=o},function(t,e){function n(t,e,n,i,r,s,a){try{var o=t[s](a),c=o.value}catch(t){return void n(t)}o.done?e(c):Promise.resolve(c).then(i,r)}t.exports=function(t){return function(){var e=this,i=arguments;return new Promise((function(r,s){var a=t.apply(e,i);function o(t){n(a,r,s,o,c,"next",t)}function c(t){n(a,r,s,o,c,"throw",t)}o(void 0)}))}}},function(t,e,n){var i=n(16),r=n(17),s=n(18);t.exports=function(t){return i(t)||r(t)||s()}},function(t,e){function n(e,i){return t.exports=n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},n(e,i)}t.exports=n},function(t,e){function n(e){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?t.exports=n=function(t){return typeof t}:t.exports=n=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(e)}t.exports=n},function(t,e){t.exports=function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}},function(t,e,n){var i=function(t){"use strict";var e=Object.prototype,n=e.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},r=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",a=i.toStringTag||"@@toStringTag";function o(t,e,n,i){var r=e&&e.prototype instanceof l?e:l,s=Object.create(r.prototype),a=new E(i||[]);return s._invoke=function(t,e,n){var i="suspendedStart";return function(r,s){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===r)throw s;return w()}for(n.method=r,n.arg=s;;){var a=n.delegate;if(a){var o=m(a,n);if(o){if(o===u)continue;return o}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===i)throw i="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i="executing";var l=c(t,e,n);if("normal"===l.type){if(i=n.done?"completed":"suspendedYield",l.arg===u)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i="completed",n.method="throw",n.arg=l.arg)}}}(t,n,a),s}function c(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=o;var u={};function l(){}function h(){}function d(){}var p={};p[r]=function(){return this};var f=Object.getPrototypeOf,v=f&&f(f(S([])));v&&v!==e&&n.call(v,r)&&(p=v);var b=d.prototype=l.prototype=Object.create(p);function y(t){["next","throw","return"].forEach((function(e){t[e]=function(t){return this._invoke(e,t)}}))}function _(t,e){var i;this._invoke=function(r,s){function a(){return new e((function(i,a){!function i(r,s,a,o){var u=c(t[r],t,s);if("throw"!==u.type){var l=u.arg,h=l.value;return h&&"object"==typeof h&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){i("next",t,a,o)}),(function(t){i("throw",t,a,o)})):e.resolve(h).then((function(t){l.value=t,a(l)}),(function(t){return i("throw",t,a,o)}))}o(u.arg)}(r,s,i,a)}))}return i=i?i.then(a,a):a()}}function m(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,m(t,e),"throw"===e.method))return u;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var i=c(n,t.iterator,e.arg);if("throw"===i.type)return e.method="throw",e.arg=i.arg,e.delegate=null,u;var r=i.arg;return r?r.done?(e[t.resultName]=r.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,u):r:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,u)}function g(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function E(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(g,this),this.reset(!0)}function S(t){if(t){var e=t[r];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,s=function e(){for(;++i<t.length;)if(n.call(t,i))return e.value=t[i],e.done=!1,e;return e.value=void 0,e.done=!0,e};return s.next=s}}return{next:w}}function w(){return{value:void 0,done:!0}}return h.prototype=b.constructor=d,d.constructor=h,d[a]=h.displayName="GeneratorFunction",t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,a in t||(t[a]="GeneratorFunction")),t.prototype=Object.create(b),t},t.awrap=function(t){return{__await:t}},y(_.prototype),_.prototype[s]=function(){return this},t.AsyncIterator=_,t.async=function(e,n,i,r,s){void 0===s&&(s=Promise);var a=new _(o(e,n,i,r),s);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},y(b),b[a]="Generator",b[r]=function(){return this},b.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var i=e.pop();if(i in t)return n.value=i,n.done=!1,n}return n.done=!0,n}},t.values=S,E.prototype={constructor:E,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function i(n,i){return a.type="throw",a.arg=t,e.next=n,i&&(e.method="next",e.arg=void 0),!!i}for(var r=this.tryEntries.length-1;r>=0;--r){var s=this.tryEntries[r],a=s.completion;if("root"===s.tryLoc)return i("end");if(s.tryLoc<=this.prev){var o=n.call(s,"catchLoc"),c=n.call(s,"finallyLoc");if(o&&c){if(this.prev<s.catchLoc)return i(s.catchLoc,!0);if(this.prev<s.finallyLoc)return i(s.finallyLoc)}else if(o){if(this.prev<s.catchLoc)return i(s.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return i(s.finallyLoc)}}}},abrupt:function(t,e){for(var i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i];if(r.tryLoc<=this.prev&&n.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var s=r;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var a=s?s.completion:{};return a.type=t,a.arg=e,s?(this.method="next",this.next=s.finallyLoc,u):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),u},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),k(n),u}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var i=n.completion;if("throw"===i.type){var r=i.arg;k(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:S(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},t}(t.exports);try{regeneratorRuntime=i}catch(t){Function("r","regeneratorRuntime = r")(i)}},function(t,e){t.exports=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}},function(t,e){t.exports=function(t){return-1!==Function.toString.call(t).indexOf("[native code]")}},function(t,e,n){var i=n(9);function r(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function s(e,n,a){return r()?t.exports=s=Reflect.construct:t.exports=s=function(t,e,n){var r=[null];r.push.apply(r,e);var s=new(Function.bind.apply(t,r));return n&&i(s,n.prototype),s},s.apply(null,arguments)}t.exports=s},function(t,e){t.exports=function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}},function(t,e){t.exports=function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}},function(t,e,n){"use strict";n.r(e);var i=n(0),r=n.n(i),s=n(7),a=n.n(s),o=n(2),c=n.n(o),u=n(3),l=n.n(u),h=n(4),d=n.n(h),p=n(1),f=n.n(p),v=n(5),b=n.n(v),y=n(6),_=n.n(y),m=n(8),g=n.n(m),k=n(11),E=n.n(k);function S(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function w(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?S(Object(n),!0).forEach((function(e){E()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):S(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var L=function(t,e){var n=[],i=e;return{getStore:function(){return i},updateStore:function(e){var r=n.length;i=t(i,e),r&&n.forEach((function(t){var n=t.callback;t.action===e.action&&n()}))},subscribeToStore:function(t){Array.isArray(t)?t.forEach((function(t){return n.push(t)})):n.push(t)}}}((function(t,e){var n=e.action,i=e.data;switch(n){case"LINES":return t=w({},t,{lineInformation:w({},i.lineInformation),lineData:{lines:w({},i.result)}});case"AUTH":return t=w({},t,{userProfile:w({},i)});case"LOADING-APP":case"LOADING-LINE":case"LOADING-HEADER":case"PUSH-SUBSCRIPTION":return t=w({},t,{},i);case"LINE-SUBSCRIBE":case"LINE-UNSUBSCRIBE":return t=w({},t,{lineSubscriptions:g()(i.lineSubscriptions)});case"SELECTED-DAYS":case"SELECTED-HOURS":case"RESET-SELECTED":return t=w({},t,{selectedSubscriptionWindow:w({},i)});case"RESET-APP":return t=w({},t,{lineSubscriptions:[]})}}),{lineData:{lines:{}},userProfile:{signedIn:!1,id:null,avatar:null},loadingState:{state:!1,line:null},pushSubscription:null,selectedSubscriptionWindow:{days:null,hours:null},lineSubscriptions:[],lineInformation:null}),x=function(){var t=a()(r.a.mark((function t(){var e,n;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e={method:"POST",headers:{"content-type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("JWT"))}},t.next=3,fetch("api/logout",e).catch((function(t){return t}));case 3:return n=t.sent,t.abrupt("return",n.status);case 5:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),C=function(){var t=a()(r.a.mark((function t(e,n,i){var s,a;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s={method:"POST",body:JSON.stringify({pushSubscription:e,line:n,window:i}),headers:{"content-type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("JWT"))}},t.next=3,fetch("api/subscribe",s).catch((function(t){return t}));case 3:return a=t.sent,console.log(a),t.next=7,a.json();case 7:return t.abrupt("return",t.sent);case 8:case"end":return t.stop()}}),t)})));return function(e,n,i){return t.apply(this,arguments)}}(),A=function(){var t=a()(r.a.mark((function t(e){var n,i;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={method:"DELETE",body:JSON.stringify({line:e}),headers:{"content-type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("JWT"))}},t.next=3,fetch("api/subscribe",n).catch((function(t){return t}));case 3:return i=t.sent,console.log(i),t.next=7,i.json();case 7:return t.abrupt("return",t.sent);case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),T=function(){var t=a()(r.a.mark((function t(){var e;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("api/lines").catch((function(t){return t}));case 2:return e=t.sent,t.next=5,e.json();case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),P=function(){var t=a()(r.a.mark((function t(){var e,n;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e={method:"GET",headers:{"content-type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("JWT"))}},t.next=3,fetch("api/subscribe",e).catch((function(t){return t}));case 3:return n=t.sent,t.next=6,n.json();case 6:return t.abrupt("return",t.sent);case 7:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),I=L.updateStore,O="BKpELtYde7iajTdW7hw1LOIksmgzApC5IMLUtwDkqDA_fdqWmdQ3FqU2azo0LH0G-2cIqq11gRrxCLtFj-pPSmE",j=function(){"serviceWorker"in navigator&&function(){return D.apply(this,arguments)}().catch(q)};function D(){return(D=a()(r.a.mark((function t(){var e,n;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,navigator.serviceWorker.register("/sw.js").catch(q);case 2:if(!(e=t.sent).active){t.next=8;break}return t.next=6,e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:N(O)}).catch(q);case 6:n=t.sent,I({action:"PUSH-SUBSCRIPTION",data:{pushSubscription:n}});case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function N(t){for(var e=(t+"=".repeat((4-t.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=window.atob(e),i=new Uint8Array(n.length),r=0;r<n.length;++r)i[r]=n.charCodeAt(r);return i}function q(t){console.error(t)}var M=n(10),H=n.n(M),R=L.getStore,W="tube-status-focus",U="button:not([disabled]), [tabindex]",K=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=document.createElement(t),i=e.copy,r=e.id,s=e.data,a=void 0===s?{}:s,o=e.classname;if(!Object.keys(e).length)return n;if(o&&n.classList.add(o),r&&n.setAttribute("id",r),Array.isArray(a)?a.forEach((function(t){var e=t.name,i=t.value;return n.setAttribute(e,i)})):Object.keys(a).length&&n.setAttribute(a.name,a.value),Array.isArray(e.event))e.event.forEach((function(t){return n.addEventListener(t.type,t.fn)}));else if("object"===H()(e.event)){var c=e.event,u=c.type,l=c.fn;n.addEventListener(u,l)}return i&&(n.innerText=i),n},B=function(t){return"day"===t?["Mo","Tu","We","Th","Fr","Sa","Su"]:["5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24"]},G=function(t){return t.map((function(t){return delete t._id,t}))},J=function(t){return t.reduce((function(t,e){return!!t.filter((function(t){return t.reason===e.reason})).length||t.push(e),t}),[])},F=function(t){document.querySelectorAll(".".concat(W)).forEach((function(t){return t.classList.remove(W)})),t instanceof HTMLElement?t.classList.add(W):t.target.classList.add(W)},z=function(t){var e=t.querySelectorAll(U),n=e[0],i=e[e.length-1];t.addEventListener("keydown",(function(t){9===t.which&&(t.shiftKey?document.activeElement===n&&(i.focus(),t.preventDefault()):document.activeElement===i&&(n.focus(),t.preventDefault()))}))},Y="LINES",V="AUTH",Q="LOADING-APP",X="LOADING-LINE",Z="LOADING-HEADER",$="LINE-SUBSCRIBE",tt="LINE-UNSUBSCRIBE",et="SELECTED-DAYS",nt="SELECTED-HOURS",it="RESET-SELECTED",rt="RESET-APP",st="line-click",at="modal-close",ot="show-subscribe",ct="show-week",ut="show-time",lt="filter-subscriptions",ht="app-ready",dt="No Service",pt="Service Closed",ft="Part Closure",vt="Planned Closure",bt="Part Suspended",yt="Severe Delays",_t="Minor Delays",mt="Good Service",gt="Special Service",kt=L.updateStore,Et=L.getStore,St=io(),wt=".tube-line",Lt=".tube-status-wrapper__message",xt=".tube-status-footer-reference",Ct=".tube-status-header__profile",At="tube-status-wrapper__message",Tt="tube-status-filter",Pt="tube-status-hide",It=function(t){function e(){var t;return c()(this,e),(t=d()(this,f()(e).call(this))).token_=localStorage.getItem("JWT"),t}var n,i,s,o;return b()(e,t),l()(e,[{key:"connectedCallback",value:(o=a()(r.a.mark((function t(){return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return kt({action:Q,data:{loadingState:{state:!0,line:null}}}),t.next=3,j();case 3:return t.next=5,this.getAllLineData_();case 5:return t.next=7,this.getLineSubscriptions_();case 7:this.order_(),kt({action:Q,data:{loadingState:{state:!1,line:null}}}),this.appReady_(),document.addEventListener(lt,this.filterView_.bind(this)),St.on("notification",this.handleNotificationRecieved_.bind(this)),this.fetchInterval_();case 13:case"end":return t.stop()}}),t,this)}))),function(){return o.apply(this,arguments)})},{key:"order_",value:function(){var t=this,e=Array.from(document.querySelectorAll(wt)).sort((function(t,e){return+e.getAttribute("score")-+t.getAttribute("score")}));Array.from(this.children).forEach((function(e){e.classList.contains(Tt)||t.removeChild(e)})),e.forEach((function(e){return t.appendChild(e)}))}},{key:"getLineSubscriptions_",value:(s=a()(r.a.mark((function t(){var e;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!Et().userProfile.signedIn){t.next=6;break}return t.next=4,P();case 4:(e=t.sent).subscriptions?kt({action:$,data:{lineSubscriptions:G(e.subscriptions)}}):this.handleError_(e);case 6:case"end":return t.stop()}}),t,this)}))),function(){return s.apply(this,arguments)})},{key:"getAllLineData_",value:(i=a()(r.a.mark((function t(){var e,n;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,T();case 2:return e=t.sent,Array.isArray(e)?n=this.formatLineInformation_(e):this.handleError_(e),t.abrupt("return",kt({action:Y,data:{result:e,lineInformation:n}}));case 5:case"end":return t.stop()}}),t,this)}))),function(){return i.apply(this,arguments)})},{key:"formatLineInformation_",value:function(t){return t.reduce((function(t,e){return e.lineStatuses.forEach((function(n){var i=n.statusSeverityDescription,r=n.reason,s=e.id,a={status:i,reason:r||null};t[s]?t[s].push(a):t[s]=[a]})),t}),{})}},{key:"fetchInterval_",value:function(){var t=this;setInterval(a()(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return kt({action:Q,data:{loadingState:{state:!0,line:null}}}),e.next=3,t.getAllLineData_();case 3:kt({action:Q,data:{loadingState:{state:!1,line:null}}});case 4:case"end":return e.stop()}}),e)}))),6e4)}},{key:"handleNotificationRecieved_",value:(n=a()(r.a.mark((function t(){return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return kt({action:Q,data:{loadingState:{state:!0,line:null}}}),t.next=3,this.getAllLineData_();case 3:kt({action:Q,data:{loadingState:{state:!1,line:null}}});case 4:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"filterView_",value:function(t){var e=t.detail.filter,n=Et().lineSubscriptions.map((function(t){return t.line})),i=this.querySelectorAll(wt),r=this.querySelector(Lt);e?(i.forEach((function(t){n.includes(t.getAttribute("line"))||t.setAttribute("hidden","")})),n.length||this.renderMessage_()):(i.forEach((function(t){t.hasAttribute("hidden")&&t.removeAttribute("hidden")})),r&&this.removeChild(r))}},{key:"renderMessage_",value:function(){var t=K("div",{classname:At,copy:"There are currently no subscriptions"});this.appendChild(t)}},{key:"appReady_",value:function(){this.classList.remove(Pt),document.querySelector(xt).classList.remove(Pt),document.querySelector(Ct).classList.remove(Pt),document.dispatchEvent(new CustomEvent(ht)),console.log(Et())}},{key:"handleError_",value:function(t){console.error(t),alert("Unable to retrieve API data.")}},{key:"disconnectedCallback",value:function(){document.removeEventListener(lt,this.filterView_)}}]),e}(_()(HTMLElement)),Ot=L.subscribeToStore,jt=L.getStore,Dt="tube-status-wrapper",Nt="tube-line-sub__status",qt="tube-line-info__reason-title",Mt="tube-line--active",Ht=function(t){function e(){var t;return c()(this,e),(t=d()(this,f()(e).call(this))).line_=t.getAttribute("line"),t.tubeStatusWrapper_,t.subStatusEl_,t.reasonTitleEl_,t.connectedCalled_=!1,t}return b()(e,t),l()(e,[{key:"connectedCallback",value:function(){this.connectedCalled_||(Ot({callback:this.updateDOM_.bind(this),action:Y}),this.addEventListener("click",this.handleClick_.bind(this)),this.addEventListener("keyup",this.handleKeyup_.bind(this)),this.addEventListener("keypress",this.handleKeyPress_.bind(this)),this.tubeStatusWrapper_=document.querySelector(".".concat(Dt)),this.subStatusEl_=this.querySelector(".".concat(Nt)),this.reasonTitleEl_=this.querySelector(".".concat(qt)),this.connectedCalled_=!0)}},{key:"handleKeyup_",value:function(t){9===t.which&&F(this)}},{key:"handleKeyPress_",value:function(t){13===t.which&&this.handleClick_(t)}},{key:"handleClick_",value:function(t){var e=t.target,n={detail:{line:this.line_}},i=this.classList.contains(Mt),r="TUBE-STATUS-AUTHENTICATION"===e.parentNode.nodeName;i&&!r&&document.dispatchEvent(new CustomEvent(st,n))}},{key:"updateDOM_",value:function(){var t=this,e=jt().lineInformation,n=J(e[this.line_]);this.removeContent_(),n.forEach((function(e,i){var r=e.status,s=e.reason,a=i===n.length-1?"":" | ";t.setScoreAttribute_(r),s?t.classList.add(Mt):t.classList.remove(Mt),n.length<=1&&(t.reasonTitleEl_.textContent=""),t.subStatusEl_.textContent="",t.subStatusEl_.textContent+="".concat(t.line_),t.reasonTitleEl_.textContent.includes(r)?t.reasonTitleEl_.textContent="":t.reasonTitleEl_.textContent+=" ".concat(r," ").concat(a)}))}},{key:"setScoreAttribute_",value:function(t){switch(t){case dt:case pt:this.setAttribute("score","6");break;case ft:case vt:this.setAttribute("score","5");break;case bt:this.setAttribute("score","4");break;case yt:this.setAttribute("score","3");break;case _t:case gt:this.setAttribute("score","2");break;case mt:this.setAttribute("score","1")}}},{key:"removeContent_",value:function(){this.subStatusEl_.textContent="",this.reasonTitleEl_.textContent=""}},{key:"disconnectedCallback",value:function(){this.removeEventListener("click",this.handleClick_),this.removeEventListener("keyup",this.handleKeyup_),this.removeEventListener("keypress",this.handleKeyPress_)}}]),e}(_()(HTMLElement)),Rt="tube-status-tooltip",Wt="tube-status-tooltip__message",Ut=function(t){function e(t,n){var i;return c()(this,e),(i=d()(this,f()(e).call(this))).message_=t,i.styles_=n,i}return b()(e,t),l()(e,[{key:"connectedCallback",value:function(){this.classList.add(Rt),this.render_()}},{key:"render_",value:function(){var t=K("div",{classname:Wt,copy:this.message_});for(var e in this.styles_)this.styles_.hasOwnProperty(e)&&(this.style[e]=this.styles_[e]);this.appendChild(t)}}]),e}(_()(HTMLElement)),Kt=L.updateStore,Bt=L.subscribeToStore,Gt=L.getStore,Jt="tube-status-authentication",Ft="tube-status-header__authentication",zt="tube-status-hide",Yt=".tube-line-sub__subscription-image",Vt=".tube-status-tooltip",Qt=".tube-status__filter-toggle--on",Xt=function(t){function e(){var t;return c()(this,e),(t=d()(this,f()(e).call(this))).dest_=t.getAttribute("dest"),t.authPath_=t.getAttribute("auth-path"),t.line_=t.parentElement.parentElement.getAttribute("line"),t.token_=localStorage.getItem("JWT"),t.toggleOnEl_,t.connectedCalled_=!1,t}var n,i;return b()(e,t),l()(e,[{key:"connectedCallback",value:function(){this.connectedCalled_||(Bt([{callback:this.attemptAttrUpdate_.bind(this),action:$},{callback:this.attemptAttrUpdate_.bind(this),action:tt},{callback:this.attemptAttrUpdate_.bind(this),action:rt}]),this.classList.add(Jt),this.toggleOnEl_=document.querySelector(Qt),this.addEventListener("keyup",this.handleKeyup_.bind(this)),this.addEventListener("keypress",this.handleKeyPress_.bind(this)),this.addEventListener("click",this.handleAuth_.bind(this)),this.classList.contains(Ft)||(this.addEventListener("mouseover",this.toggleTooltip_.bind(this)),this.addEventListener("mouseout",this.toggleTooltip_.bind(this))),this.handleJWT_(),this.render_(),this.connectedCalled_=!0)}},{key:"handleKeyup_",value:function(t){t.stopImmediatePropagation(),9===t.which&&F(this)}},{key:"handleKeyPress_",value:function(t){t.stopImmediatePropagation(),13===t.which&&this.handleAuth_(t)}},{key:"toggleTooltip_",value:function(t){var e={top:"-18px",left:"50px"};if("mouseout"!==t.type){var n="subscribe"===this.authPath_?new Ut("Subscribe to line for push notification status updates",e):new Ut("Unsubscribe from line push notification status updates",e);this.appendChild(n)}else{var i=document.querySelector(Vt);i.parentNode.removeChild(i)}}},{key:"handleJWT_",value:function(){if(this.token_){var t=JSON.parse(window.atob(this.token_.split(".")[1])),e=t.photos,n=t.id;Kt({action:V,data:{signedIn:!0,avatar:e[0].value,id:n}})}}},{key:"attemptAttrUpdate_",value:function(){var t,e,n=Gt().userProfile.signedIn,i=this.classList.contains(Ft);n&&i?this.setAttribute("auth-path","Sign out"):this.setAttribute("auth-path","Sign in"),i||(Object.keys((t=this.line_,e=R().lineSubscriptions.filter((function(e){return e.line===t})),e.length?e[0]:{})).length?this.setAttribute("auth-path","unsubscribe"):this.setAttribute("auth-path","subscribe")),this.authPath_=this.getAttribute("auth-path"),this.render_()}},{key:"handleAuth_",value:function(t){var e=Gt().userProfile;switch(t.stopPropagation(),this.authPath_){case"Sign in":window.location.href=this.dest_;break;case"Sign out":this.handleLogout_();break;case"subscribe":e.signedIn?this.emit_():window.location.href=this.dest_;break;case"unsubscribe":e.signedIn?this.handleUnSubscribeRequest_():window.location.href=this.dest_}}},{key:"emit_",value:function(){var t={detail:{line:this.line_}};document.dispatchEvent(new CustomEvent(ot,t))}},{key:"handleLogout_",value:(i=a()(r.a.mark((function t(){var e;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Kt({action:Z,data:{loadingState:{state:!0,line:null}}}),t.next=3,x();case 3:if(200!==(e=t.sent)){t.next=16;break}return t.next=7,new Promise((function(t){return setTimeout(t,300)}));case 7:localStorage.removeItem("JWT"),Kt({action:V,data:{signedIn:!1,avatar:null,id:null}}),this.authPath_="Sign in",this.render_(),Kt({action:Z,data:{loadingState:{state:!1,line:null}}}),Kt({action:rt}),console.log(L.getStore()),t.next=17;break;case 16:this.handleError_(e);case 17:case"end":return t.stop()}}),t,this)}))),function(){return i.apply(this,arguments)})},{key:"handleUnSubscribeRequest_",value:(n=a()(r.a.mark((function t(){var e,n,i,s;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e={detail:{filter:!0}},n=document.querySelector(Qt),Kt({action:X,data:{loadingState:{state:!0,line:this.line_}}}),t.next=5,A(this.line_);case 5:if(i=t.sent,!(s=i.subscription)){t.next=13;break}return t.next=10,new Promise((function(t){return setTimeout(t,500)}));case 10:Kt({action:tt,data:{lineSubscriptions:G(s)}}),t.next=14;break;case 13:this.handleError_(i);case 14:Kt({action:X,data:{loadingState:{state:!1,line:this.line_}}}),n.classList.contains(zt)||document.dispatchEvent(new CustomEvent(lt,e));case 16:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"render_",value:function(){this.classList.contains(Ft)?this.innerHTML=this.authPath_:this.querySelector(Yt).src="unsubscribe"===this.authPath_?"/images/unsubscribe.svg":"/images/subscribe.svg"}},{key:"handleError_",value:function(t){console.error("Unable to subscribe to line at this time. ".concat(t))}},{key:"disconnectedCallback",value:function(){this.removeEventListener("click",this.handleAuth_),this.removeEventListener("keyup",this.handleKeyup_),this.removeEventListener("keypress",this.handleKeyPress_),this.classList.contains(Ft)||(this.removeEventListener("mouseover",this.toggleTooltip_.bind(this)),this.removeEventListener("mouseout",this.toggleTooltip_.bind(this)))}}]),e}(_()(HTMLElement)),Zt=L.subscribeToStore,$t=L.getStore,te="tube-status-loading--active",ee="tube-status-loading--active-line",ne="tube-status-loading--active-header",ie="app-wrapper--hidden",re=".app-wrapper",se=function(t){function e(){var t;return c()(this,e),(t=d()(this,f()(e).call(this))).appWrapper_,t.line_=t.parentElement.parentElement.getAttribute("line"),t.connectedCalled_=!1,t}return b()(e,t),l()(e,[{key:"connectedCallback",value:function(){if(!this.connectedCalled_){var t,e,n=this.hasAttribute("app"),i=this.hasAttribute("header");this.appWrapper_=document.querySelector(re),n?(t=Q,e=this.handleLoadingApp_.bind(this)):i?(t=Z,e=this.handleLoadingHeader_.bind(this)):(t=X,e=this.handleLoadingLine_.bind(this)),Zt({callback:e,action:t}),this.connectedCalled_=!0}}},{key:"handleLoadingApp_",value:function(){$t().loadingState.state?(this.appWrapper_.classList.add(ie),this.classList.add(te)):(this.appWrapper_.classList.remove(ie),this.classList.remove(te))}},{key:"handleLoadingLine_",value:function(){var t=$t().loadingState,e=t.state,n=t.line,i=this.classList;this.line_===n&&(e?i.add(ee):i.remove(ee))}},{key:"handleLoadingHeader_",value:function(){var t=$t().loadingState.state,e=this.classList;t?e.add(ne):e.remove(ne)}}]),e}(_()(HTMLElement)),ae=L.getStore,oe=L.updateStore,ce=L.subscribeToStore,ue="tube-status-modal--active",le="tube-status-modal--subscribe",he="tube-status-modal__caption",de="tube-status-modal__reason",pe="tube-status-modal__icon",fe="dim",ve="tube-status-modal-sub",be="tube-status-modal-sub__title",ye="tube-status-modal-sub__select",_e="tube-status-modal-sub__btn",me="tube-status-modal-sub__btn-times",ge="tube-status-modal-sub__btn-days",ke="tube-status-btn--selected",Ee="tube-status-week",Se="tube-status-time",we=".overlay",Le=function(t){function e(){var t;return c()(this,e),(t=d()(this,f()(e).call(this))).overlay_,t.line_,t}var n;return b()(e,t),l()(e,[{key:"connectedCallback",value:function(){this.overlay_=document.querySelector(we);var t=[{callback:this.updateSelectDaysBtn_.bind(this),action:et},{callback:this.updateSelectTimesBtn_.bind(this),action:nt}];ce(t),document.addEventListener(st,this.toggleModal_.bind(this)),document.addEventListener(ot,this.renderSubscriptionOptions_.bind(this))}},{key:"emit_",value:function(t){var e,n=t.target,i={detail:{line:this.line_}};e=n.classList.contains(ge)?ct:ut,document.dispatchEvent(new CustomEvent(e,i))}},{key:"updateSelectDaysBtn_",value:function(){var t=ae().selectedSubscriptionWindow.days,e=this.querySelector(".".concat(ge));t&&(t.length?(e.textContent="Selected",e.classList.add(ke)):(e.textContent="Select days",e.classList.remove(ke)))}},{key:"updateSelectTimesBtn_",value:function(){var t=ae().selectedSubscriptionWindow.hours,e=this.querySelector(".".concat(me));t&&(t.length?(e.textContent="Selected",e.classList.add(ke)):(e.textContent="Select times",e.classList.remove(ke)))}},{key:"renderSubscriptionOptions_",value:function(t){var e=[{type:"click",fn:this.emit_.bind(this)},{type:"keyup",fn:F}],n=[{type:"click",fn:this.handleSubscriptionRequest_.bind(this)},{type:"keyup",fn:F}],i=K("div",{classname:ve}),r=K("div",{classname:ye}),s=K("div",{classname:be,copy:"Specify your subscription times:"}),a=K("button",{copy:"Select days",classname:ge,event:e,data:{name:"tabindex",value:"0"}}),o=K("button",{copy:"Select times",classname:me,event:e,data:{name:"tabindex",value:"0"}}),c=K("button",{copy:"Subscribe",classname:_e,event:n,data:{name:"tabindex",value:"0"}});this.line_=t.detail.line,this.overlay_.classList.add(fe),this.classList.add(ue),this.classList.add(le),this.appendChild(this.createModalIcon_()),r.appendChild(a),r.appendChild(o),[s,r,c].forEach((function(t){return i.appendChild(t)})),this.appendChild(i),this.setAttribute("tabindex","0"),this.focus(),z(this)}},{key:"handleSubscriptionRequest_",value:(n=a()(r.a.mark((function t(e){var n,i,s,a,o,c;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=ae(),i=n.userProfile,s=n.pushSubscription,a=n.selectedSubscriptionWindow,!i.signedIn||!s){t.next=19;break}return t.next=4,C(s,this.line_,a);case 4:if(o=t.sent,!(c=o.subscription).length){t.next=16;break}return this.toggleModal_(),oe({action:X,data:{loadingState:{state:!0,line:this.line_}}}),t.next=11,new Promise((function(t){return setTimeout(t,500)}));case 11:oe({action:X,data:{loadingState:{state:!1,line:this.line_}}}),oe({action:$,data:{lineSubscriptions:G(c)}}),oe({action:it,data:{days:null,hours:null}}),t.next=17;break;case 16:this.handleError_(o);case 17:t.next=20;break;case 19:this.handleError_("Push subscription object not found");case 20:case"end":return t.stop()}}),t,this)}))),function(t){return n.apply(this,arguments)})},{key:"populateModal_",value:function(t){var e=this,n=K("div",{classname:he});t.forEach((function(t){var i=t.reason,r=n.textContent.trimLeft()===i,s=K("div",{classname:de});r||(s.textContent+=" ".concat(i),n.appendChild(s)),e.renderDelayContext_(n)})),this.setAttribute("tabindex","0"),this.focus()}},{key:"toggleModal_",value:function(t){var e=t?t.which:null,n=t?t.type:null,i=document.querySelector(".".concat(pe));if("line-click"===n||"click"===n||13===e||!t){var r=ae().lineInformation,s=t?t.detail.line:null;this.removeContent_(),s?(this.overlay_.classList.add(fe),this.classList.add(ue),this.populateModal_(J(r[s])),z(this)):(this.overlay_.classList.remove(fe),this.classList.remove(ue),this.classList.remove(le),document.dispatchEvent(new CustomEvent(at)))}else 9===e&&F(i)}},{key:"createModalIcon_",value:function(){var t=[{type:"click",fn:this.toggleModal_.bind(this)},{type:"keyup",fn:this.toggleModal_.bind(this)},{type:"keypress",fn:this.toggleModal_.bind(this)}];return K("div",{classname:pe,event:t,data:{name:"tabindex",value:"0"}})}},{key:"renderDelayContext_",value:function(t){this.querySelector(".".concat(he))?(this.removeContent_(),this.appendChild(this.createModalIcon_()),this.appendChild(t)):(this.appendChild(this.createModalIcon_()),this.appendChild(t))}},{key:"removeContent_",value:function(){var t=this;Array.from(this.childNodes).filter((function(t){var e=t.nodeName.toLowerCase();if(![Ee,Se].includes(e))return t})).forEach((function(e){return t.removeChild(e)})),oe({action:it,data:{days:null,hours:null}})}},{key:"handleError_",value:function(t){console.error("Unable to subscribe to line at this time. ".concat(t))}},{key:"disconnectedCallback",value:function(){document.removeEventListener(st,this.toggleModal_),document.removeEventListener(ot,this.renderSubscriptionOptions_.bind(this))}}]),e}(_()(HTMLElement)),xe=L.subscribeToStore,Ce=L.getStore,Ae=".tube-status-header__authentication",Te=".tube-status-header__avatar-image",Pe=function(t){function e(){var t;return c()(this,e),(t=d()(this,f()(e).call(this))).avatarEl_,t.authenticationEl_,t}return b()(e,t),l()(e,[{key:"connectedCallback",value:function(){xe({callback:this.updateAvatar_.bind(this),action:V}),this.avatarEl_=this.querySelector(Te),this.authenticationEl_=this.querySelector(Ae),this.updateAvatar_()}},{key:"updateAvatar_",value:function(){var t=Ce().userProfile,e=t.signedIn,n=t.avatar;this.avatarEl_.src=e?n:"/images/account_circle.svg"}}]),e}(_()(HTMLElement)),Ie=L.updateStore,Oe=L.getStore,je="tube-status-week--active",De="tube-status-week-day",Ne="tube-status-week-day__select",qe="tube-status-week-day__select--active",Me="tube-status-week__btn",He="tube-status-modal-sub__btn-times",Re=function(t){function e(){var t;return c()(this,e),(t=d()(this,f()(e).call(this))).line_,t.days_=[],t.markupExists_=!1,t}return b()(e,t),l()(e,[{key:"connectedCallback",value:function(){document.addEventListener(ct,this.initHandler_.bind(this)),document.addEventListener(at,this.reset_.bind(this)),document.addEventListener("click",this.reset_.bind(this))}},{key:"handlePreselect_",value:function(){var t=this,e=Oe().selectedSubscriptionWindow.days,n=Array.from(this.querySelectorAll(".".concat(Ne)));this.days_=e,n.forEach((function(e){t.days_.includes(e.getAttribute("day"))&&e.classList.add(qe)}))}},{key:"initHandler_",value:function(t){var e=Oe().selectedSubscriptionWindow.days;this.markupExists_?this.reset_():(this.render_(t),e&&this.handlePreselect_())}},{key:"handleSubmitDays_",value:function(){var t=Oe().selectedSubscriptionWindow.hours;Ie({action:et,data:{days:this.days_,hours:t}}),this.reset_()}},{key:"reset_",value:function(t){var e=this,n=Array.from(this.childNodes);if(t){var i=t.target;if(i.classList&&!i.classList.contains(He))return}this.classList.remove(je),this.removeAttribute("tabindex"),this.days_=[],this.markupExists_=!1,n.forEach((function(t){return e.removeChild(t)}))}},{key:"render_",value:function(t){var e=this,n=[{type:"click",fn:this.handleSubmitDays_.bind(this)},{type:"keyup",fn:F}],i=K("button",{classname:Me,event:n,data:{name:"tabindex",value:"0"},copy:"Submit days"}),r=K("table"),s=K("thead"),a=K("tbody"),o=K("tr"),c=B("day").map((function(t){return K("th",{classname:De,copy:t})}));this.line_=t.detail.line,this.classList.add(je),c.forEach((function(t){var n=[{name:"day",value:t.innerText},{name:"tabindex",value:"0"}],i=[{type:"click",fn:e.handleDayClick_.bind(e)},{type:"keydown",fn:e.handleDayClick_.bind(e)},{type:"keyup",fn:F}],r=K("td",{classname:Ne,data:n,event:i});s.appendChild(t),o.appendChild(r)})),r.appendChild(s),a.appendChild(o),r.appendChild(a),this.appendChild(r),this.appendChild(i),this.markupExists_=!0,this.setAttribute("tabindex","0"),this.focus(),z(this)}},{key:"handleDayClick_",value:function(t){var e=t.target,n=t.which;if("click"===t.type||13===n){var i=e.getAttribute("day");e.classList.contains(qe)?(e.classList.remove(qe),this.days_=this.days_.filter((function(t){return i!==t}))):(e.classList.add(qe),this.days_=this.days_.includes(i)?[i]:[].concat(g()(this.days_),[i])),console.log(this.days_)}}},{key:"disconnectedCallback",value:function(){document.removeEventListener(ct,this.initHandler_),document.removeEventListener(at,this.reset_),document.removeEventListener("click",this.reset_)}}]),e}(_()(HTMLElement)),We=L.updateStore,Ue=L.getStore,Ke="tube-status-time--active",Be="tube-status-time-hour",Ge="tube-status-time-hour__select",Je="tube-status-time-hour__select--active",Fe="tube-status-time__btn",ze="tube-status-modal-sub__btn-days",Ye="tube-status-time__table-wrapper",Ve=".tube-status-tooltip__message",Qe=function(t){function e(){var t;return c()(this,e),(t=d()(this,f()(e).call(this))).line_,t.hours_=[],t.markupExists_=!1,t}return b()(e,t),l()(e,[{key:"connectedCallback",value:function(){document.addEventListener(ut,this.initHandler_.bind(this)),document.addEventListener(at,this.reset_.bind(this)),document.addEventListener("click",this.reset_.bind(this))}},{key:"handlePreselect_",value:function(){var t=this,e=Ue().selectedSubscriptionWindow.hours,n=Array.from(this.querySelectorAll(".".concat(Ge)));this.hours_=e,n.forEach((function(e){t.hours_.includes(+e.getAttribute("hour"))&&e.classList.add(Je)}))}},{key:"initHandler_",value:function(t){var e=Ue().selectedSubscriptionWindow.hours;this.markupExists_?this.reset_():(this.render_(t),e&&this.handlePreselect_())}},{key:"handleSubmitHours_",value:function(){var t=Ue().selectedSubscriptionWindow.days,e=this.querySelector(Ve);if(1!==this.hours_.length)We({action:nt,data:{days:t,hours:this.hours_}}),this.reset_();else{if(e)return;this.querySelector(".".concat(Fe)).insertAdjacentElement("afterend",new Ut("Please select a range of a least one hour i.e. 09:00 – 10:00.",{bottom:"-45px",left:"-60px"}))}}},{key:"reset_",value:function(t){var e=this,n=Array.from(this.childNodes);if(t){var i=t.target;if(i.classList&&!i.classList.contains(ze))return}this.classList.remove(Ke),this.removeAttribute("tabindex"),this.hours_=[],this.markupExists_=!1,n.forEach((function(t){return e.removeChild(t)}))}},{key:"render_",value:function(t){var e=this,n=[{type:"click",fn:this.handleSubmitHours_.bind(this)},{type:"keyup",fn:F}],i=K("button",{classname:Fe,copy:"Submit time range",data:{name:"tabindex",value:"0"},event:n}),r=K("div",{classname:Ye}),s=K("table"),a=K("thead"),o=K("tbody"),c=K("tr"),u=B("hours").map((function(t){return K("th",{classname:Be,copy:t})}));this.line_=t.detail.line,this.classList.add(Ke),u.forEach((function(t){var n=[{name:"hour",value:t.innerText},{name:"tabindex",value:"0"}],i=[{type:"click",fn:e.handleHourClick_.bind(e)},{type:"keydown",fn:e.handleHourClick_.bind(e)},{type:"keyup",fn:F}],r=K("td",{classname:Ge,data:n,event:i});a.appendChild(t),c.appendChild(r)})),s.appendChild(a),o.appendChild(c),s.appendChild(o),r.appendChild(s),this.appendChild(r),this.appendChild(i),this.markupExists_=!0,this.setAttribute("tabindex","0"),this.focus(),z(this)}},{key:"handleHourClick_",value:function(t){var e=this,n=t.target,i=t.which;if("click"===t.type||13===i){var r=+n.getAttribute("hour");if(n.classList.contains(Je))this.querySelectorAll("\n          .".concat(Je)).forEach((function(t){return t.classList.remove(Je)})),this.hours_=[];else n.classList.add(Je),this.hours_.length?(this.hours_=this.createRange_(r),this.hours_.forEach((function(t){e.querySelector('[hour="'.concat(t,'"]')).classList.add(Je)}))):this.hours_=[r];console.log(this.hours_)}}},{key:"createRange_",value:function(t){for(var e=[].concat(g()(this.hours_),[t]).sort((function(t,e){return t-e})),n=[e[0]],i=e[e.length-1]-e[0]-1,r=0;r<=i;r++)n.push(n[n.length-1]+1);return n}},{key:"disconnectedCallback",value:function(){document.removeEventListener(ut,this.initHandler_),document.removeEventListener(at,this.reset_),document.removeEventListener("click",this.reset_)}}]),e}(_()(HTMLElement)),Xe=L.getStore,Ze=L.subscribeToStore,$e="tube-status-subscriptions__dropdown",tn="tube-status-subscriptions__heading",en="tube-status-subscriptions__line",nn="tube-status-subscriptions__line-name",rn="tube-status-subscriptions__line-color",sn="tube-status-subscriptions__notifcation",an="tube-status-header__subscription-image",on=".tube-status-header__subscription-image",cn=function(t){function e(){var t;return c()(this,e),(t=d()(this,f()(e).call(this))).subIconEl_,t}return b()(e,t),l()(e,[{key:"connectedCallback",value:function(){Ze([{callback:this.renderNotificationIcon_.bind(this),action:$},{callback:this.renderNotificationIcon_.bind(this),action:tt},{callback:this.removeContent_.bind(this),action:rt}]),document.addEventListener("click",this.toggleSubscriptions_.bind(this)),this.addEventListener("keyup",this.handleKeyup_.bind(this)),this.addEventListener("keypress",this.handleKeyPress_.bind(this)),this.subIconEl_=this.querySelector(on)}},{key:"handleKeyup_",value:function(t){9===t.which&&F(this)}},{key:"handleKeyPress_",value:function(t){13===t.which&&this.toggleSubscriptions_(t)}},{key:"dropdownExists_",value:function(){return Array.from(this.children).some((function(t){return t.classList.contains($e)}))}},{key:"renderNotificationIcon_",value:function(){var t=Xe().lineSubscriptions,e=this.querySelector(".".concat(sn));if(t.length){e&&this.removeChild(e);var n=K("div",{classname:sn,copy:t.length});this.appendChild(n)}}},{key:"updateIcon_",value:function(){this.dropdownExists_()?this.subIconEl_.src="/images/subscriptions.svg":this.subIconEl_.src="/images/subscriptions-filled.svg"}},{key:"toggleSubscriptions_",value:function(t){var e=t.target,n=t.which;e.parentNode!==this&&!(13===n)?this.dropdownExists_()&&(this.updateIcon_(),this.removeContent_()):(this.updateIcon_(),this.dropdownExists_()?this.removeContent_():this.renderSubscriptionList_())}},{key:"renderSubscriptionList_",value:function(){this.removeContent_();var t=Xe().lineSubscriptions,e=t.length?"Current subscriptions":"No subscriptions",n=K("div",{classname:$e}),i=K("h2",{classname:tn,copy:e});n.appendChild(i),t.forEach((function(t){var e=K("div",{classname:en}),i=K("span",{classname:nn,copy:t.line}),r=K("span",{classname:"".concat(rn,"-").concat(t.line)});e.appendChild(i),e.appendChild(r),n.appendChild(e)})),this.appendChild(n)}},{key:"removeContent_",value:function(){var t=this,e=L.getStore().userProfile.signedIn;Array.from(this.children).filter((function(t){var n=t.classList.contains(an),i=t.classList.contains(sn);if(e?!n&&!i:!n)return t})).forEach((function(e){return t.removeChild(e)}))}},{key:"disconnectedCallback",value:function(){this.removeEventListener("click",this.toggleSubscriptions_),this.removeEventListener("keyup",this.handleKeyup_),this.removeEventListener("keypress",this.handleKeyPress_)}}]),e}(_()(HTMLElement)),un=L.subscribeToStore,ln=L.getStore,hn=".tube-status__filter-toggle .material-icons",dn=".tube-status__filter-toggle",pn="tube-status-filter--active",fn="tube-status-hide",vn=function(t){function e(){var t;return c()(this,e),(t=d()(this,f()(e).call(this))).filter_=!1,t.toggleIconEls_=t.querySelectorAll(hn),t.filterToggle_=t.querySelector(dn),t}return b()(e,t),l()(e,[{key:"connectedCallback",value:function(){var t=this;un({callback:this.toggleDisplay_.bind(this),action:V}),this.toggleIconEls_.forEach((function(e){e.addEventListener("click",t.handleClick_.bind(t))})),this.addEventListener("keyup",this.handleKeyup_.bind(this)),this.addEventListener("keypress",this.handleKeyPress_),document.addEventListener(ht,this.toggleDisplay_.bind(this))}},{key:"handleKeyup_",value:function(t){9===t.which&&F(this.filterToggle_)}},{key:"handleKeyPress_",value:function(t){13===t.which&&(this.emit_(),this.toggleIcon_())}},{key:"handleClick_",value:function(t){this.emit_(),this.toggleIcon_()}},{key:"toggleDisplay_",value:function(){ln().userProfile.signedIn?this.classList.add(pn):this.classList.remove(pn)}},{key:"emit_",value:function(){this.filter_=!this.filter_;var t={detail:{filter:this.filter_}};document.dispatchEvent(new CustomEvent(lt,t))}},{key:"toggleIcon_",value:function(){this.toggleIconEls_.forEach((function(t){t.classList.contains(fn)?t.classList.remove(fn):t.classList.add(fn)}))}},{key:"disconnectedCallback",value:function(){this.removeEventListener("click",this.handleClick_),this.removeEventListener("keyup",this.handleKeyup_),this.removeEventListener("keypress",this.handleKeyPress_)}}]),e}(_()(HTMLElement));window.customElements.define("tube-status-modal",Le),window.customElements.define("tube-status-loading",se),window.customElements.define("tube-status-wrapper",It),window.customElements.define("tube-line",Ht),window.customElements.define("tube-status-header",Pe),window.customElements.define("tube-status-authentication",Xt),window.customElements.define("tube-status-week",Re),window.customElements.define("tube-status-time",Qe),window.customElements.define("tube-status-tooltip",Ut),window.customElements.define("tube-status-subscriptions",cn),window.customElements.define("tube-status-filter",vn)}]);